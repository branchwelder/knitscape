(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();var Y=typeof window<"u"?window:null,Ue=Y===null,Ot=Ue?void 0:Y.document,X="addEventListener",F="removeEventListener",$e="getBoundingClientRect",Tt="_a",B="_b",j="_c",te="horizontal",U=function(){return!1},Yi=Ue?"calc":["","-webkit-","-moz-","-o-"].filter(function(e){var t=Ot.createElement("div");return t.style.cssText="width:"+e+"calc(9px)",!!t.style.length}).shift()+"calc",Fn=function(e){return typeof e=="string"||e instanceof String},hn=function(e){if(Fn(e)){var t=Ot.querySelector(e);if(!t)throw new Error("Selector "+e+" did not match a DOM element");return t}return e},P=function(e,t,n){var i=e[t];return i!==void 0?i:n},ee=function(e,t,n,i){if(t){if(i==="end")return 0;if(i==="center")return e/2}else if(n){if(i==="start")return 0;if(i==="center")return e/2}return e},Xi=function(e,t){var n=Ot.createElement("div");return n.className="gutter gutter-"+t,n},Fi=function(e,t,n){var i={};return Fn(t)?i[e]=t:i[e]=Yi+"("+t+"% - "+n+"px)",i},Bi=function(e,t){var n;return n={},n[e]=t+"px",n},Ui=function(e,t){if(t===void 0&&(t={}),Ue)return{};var n=e,i,r,s,o,a,l;Array.from&&(n=Array.from(n));var h=hn(n[0]),c=h.parentNode,f=getComputedStyle?getComputedStyle(c):null,d=f?f.flexDirection:null,u=P(t,"sizes")||n.map(function(){return 100/n.length}),g=P(t,"minSize",100),p=Array.isArray(g)?g:n.map(function(){return g}),_=P(t,"maxSize",1/0),y=Array.isArray(_)?_:n.map(function(){return _}),x=P(t,"expandToMin",!1),S=P(t,"gutterSize",10),w=P(t,"gutterAlign","center"),N=P(t,"snapOffset",30),E=Array.isArray(N)?N:n.map(function(){return N}),k=P(t,"dragInterval",1),$=P(t,"direction",te),M=P(t,"cursor",$===te?"col-resize":"row-resize"),O=P(t,"gutter",Xi),nt=P(t,"elementStyle",Fi),W=P(t,"gutterStyle",Bi);$===te?(i="width",r="clientX",s="left",o="right",a="clientWidth"):$==="vertical"&&(i="height",r="clientY",s="top",o="bottom",a="clientHeight");function I(b,v,m,A){var z=nt(i,v,m,A);Object.keys(z).forEach(function(C){b.style[C]=z[C]})}function Jt(b,v,m){var A=W(i,v,m);Object.keys(A).forEach(function(z){b.style[z]=A[z]})}function it(){return l.map(function(b){return b.size})}function Ct(b){return"touches"in b?b.touches[0][r]:b[r]}function sn(b){var v=l[this.a],m=l[this.b],A=v.size+m.size;v.size=b/this.size*A,m.size=A-b/this.size*A,I(v.element,v.size,this[B],v.i),I(m.element,m.size,this[j],m.i)}function Li(b){var v,m=l[this.a],A=l[this.b];this.dragging&&(v=Ct(b)-this.start+(this[B]-this.dragOffset),k>1&&(v=Math.round(v/k)*k),v<=m.minSize+m.snapOffset+this[B]?v=m.minSize+this[B]:v>=this.size-(A.minSize+A.snapOffset+this[j])&&(v=this.size-(A.minSize+this[j])),v>=m.maxSize-m.snapOffset+this[B]?v=m.maxSize+this[B]:v<=this.size-(A.maxSize-A.snapOffset+this[j])&&(v=this.size-(A.maxSize+this[j])),sn.call(this,v),P(t,"onDrag",U)(it()))}function on(){var b=l[this.a].element,v=l[this.b].element,m=b[$e](),A=v[$e]();this.size=m[i]+A[i]+this[B]+this[j],this.start=m[s],this.end=m[o]}function Di(b){if(!getComputedStyle)return null;var v=getComputedStyle(b);if(!v)return null;var m=b[a];return m===0?null:($===te?m-=parseFloat(v.paddingLeft)+parseFloat(v.paddingRight):m-=parseFloat(v.paddingTop)+parseFloat(v.paddingBottom),m)}function an(b){var v=Di(c);if(v===null||p.reduce(function(C,H){return C+H},0)>v)return b;var m=0,A=[],z=b.map(function(C,H){var lt=v*C/100,Qt=ee(S,H===0,H===b.length-1,w),jt=p[H]+Qt;return lt<jt?(m+=jt-lt,A.push(0),jt):(A.push(lt-jt),lt)});return m===0?b:z.map(function(C,H){var lt=C;if(m>0&&A[H]-m>0){var Qt=Math.min(m,A[H]-m);m-=Qt,lt=C-Qt}return lt/v*100})}function Ri(){var b=this,v=l[b.a].element,m=l[b.b].element;b.dragging&&P(t,"onDragEnd",U)(it()),b.dragging=!1,Y[F]("mouseup",b.stop),Y[F]("touchend",b.stop),Y[F]("touchcancel",b.stop),Y[F]("mousemove",b.move),Y[F]("touchmove",b.move),b.stop=null,b.move=null,v[F]("selectstart",U),v[F]("dragstart",U),m[F]("selectstart",U),m[F]("dragstart",U),v.style.userSelect="",v.style.webkitUserSelect="",v.style.MozUserSelect="",v.style.pointerEvents="",m.style.userSelect="",m.style.webkitUserSelect="",m.style.MozUserSelect="",m.style.pointerEvents="",b.gutter.style.cursor="",b.parent.style.cursor="",Ot.body.style.cursor=""}function Oi(b){if(!("button"in b&&b.button!==0)){var v=this,m=l[v.a].element,A=l[v.b].element;v.dragging||P(t,"onDragStart",U)(it()),b.preventDefault(),v.dragging=!0,v.move=Li.bind(v),v.stop=Ri.bind(v),Y[X]("mouseup",v.stop),Y[X]("touchend",v.stop),Y[X]("touchcancel",v.stop),Y[X]("mousemove",v.move),Y[X]("touchmove",v.move),m[X]("selectstart",U),m[X]("dragstart",U),A[X]("selectstart",U),A[X]("dragstart",U),m.style.userSelect="none",m.style.webkitUserSelect="none",m.style.MozUserSelect="none",m.style.pointerEvents="none",A.style.userSelect="none",A.style.webkitUserSelect="none",A.style.MozUserSelect="none",A.style.pointerEvents="none",v.gutter.style.cursor=M,v.parent.style.cursor=M,Ot.body.style.cursor=M,on.call(v),v.dragOffset=Ct(b)-v.end}}u=an(u);var at=[];l=n.map(function(b,v){var m={element:hn(b),size:u[v],minSize:p[v],maxSize:y[v],snapOffset:E[v],i:v},A;if(v>0&&(A={a:v-1,b:v,dragging:!1,direction:$,parent:c},A[B]=ee(S,v-1===0,!1,w),A[j]=ee(S,!1,v===n.length-1,w),d==="row-reverse"||d==="column-reverse")){var z=A.a;A.a=A.b,A.b=z}if(v>0){var C=O(v,$,m.element);Jt(C,S,v),A[Tt]=Oi.bind(A),C[X]("mousedown",A[Tt]),C[X]("touchstart",A[Tt]),c.insertBefore(C,m.element),A.gutter=C}return I(m.element,m.size,ee(S,v===0,v===n.length-1,w),v),v>0&&at.push(A),m});function ln(b){var v=b.i===at.length,m=v?at[b.i-1]:at[b.i];on.call(m);var A=v?m.size-b.minSize-m[j]:b.minSize+m[B];sn.call(m,A)}l.forEach(function(b){var v=b.element[$e]()[i];v<b.minSize&&(x?ln(b):b.minSize=v)});function Hi(b){var v=an(b);v.forEach(function(m,A){if(A>0){var z=at[A-1],C=l[z.a],H=l[z.b];C.size=v[A-1],H.size=m,I(C.element,C.size,z[B],C.i),I(H.element,H.size,z[j],H.i)}})}function Vi(b,v){at.forEach(function(m){if(v!==!0?m.parent.removeChild(m.gutter):(m.gutter[F]("mousedown",m[Tt]),m.gutter[F]("touchstart",m[Tt])),b!==!0){var A=nt(i,m.a.size,m[B]);Object.keys(A).forEach(function(z){l[m.a].element.style[z]="",l[m.b].element.style[z]=""})}})}return{setSizes:Hi,getSizes:it,collapse:function(v){ln(l[v])},destroy:Vi,parent:c,pairs:at}};class ne{constructor({paneEvents:t,id:n,split:i,close:r,paneDom:s,manager:o}){this.id=n,this.dom=document.createElement("div"),this.dom.classList.add("pane-container","dropzone"),this.dom.id=`${this.id}-container`,this.manager=o,this.dom.appendChild(this.createToolbar(i,r)),this.paneDom=s??document.createElement("div"),this.paneDom.id=this.id,this.paneDom.classList.add("pane"),this.dom.appendChild(this.paneDom),t&&Object.entries(t).forEach(([a,l])=>this.dom[a]=h=>l(h,this.id))}createToolbar(t,n){const i=document.createElement("div");i.classList.add("pane-toolbar"),i.draggable=!0;const r=document.createElement("button");r.onclick=()=>t("horizontal"),r.innerText="=",i.appendChild(r);const s=document.createElement("button");s.onclick=()=>t("vertical"),s.innerText="||",i.appendChild(s);const o=document.createElement("button");return o.onclick=()=>n(),o.innerText="X",i.appendChild(o),i}saveLayout(){return this.manager.paneMap[this.id]}}class yt{constructor(t,n,{sizes:i,direction:r="horizontal",id:s,collapse:o}){t.length<2&&console.warn("Problem building split layout: SplitGroups must have at least two children"),this.manager=n,this.direction=r,this.id=s,this.sizes=i,this.collapse=o,this.currentSplitID=0,this.dom=document.createElement("div"),this.dom.id=this.id,this.dom.classList.add(r),this.children=t.map(a=>this.createChild(a)),this.children.forEach(a=>this.dom.appendChild(a.dom)),this.split,this.updateSplit()}createSplit(t){const n=`${this.id}-${this.currentSplitID}`;return this.currentSplitID++,new yt(t.children,this.manager,{id:n,sizes:t.sizes,direction:this.oppositeAxis(),collapse:i=>this.collapseSplitGroup(n,i)})}adoptSplit(t){const n=`${this.id}-${this.currentSplitID}`;return this.currentSplitID++,t.id=n,t.collapse=i=>this.collapseSplitGroup(n,i),t}createPane({id:t,paneDom:n}){return new ne({id:t,paneDom:n,manager:this.manager,paneEvents:this.manager.paneEvents,split:i=>i==this.direction?this.convertPaneToSplit(t):this.insertChild(this.createChild("empty"),this.getChildIndex(t)),close:()=>this.closePane(t)})}createChild(t){return t instanceof ne?this.createPane({id:t.id,paneDom:t.paneDom}):t instanceof yt?this.adoptSplit(t):t.children?this.createSplit(t):this.createPane({id:this.manager.registerPane(t)})}updateSplit(){if(this.split&&this.split.destroy(),this.sizes.length!=this.children.length)throw new Error("Error: Children array out of sync with sizes");let t=100/this.sizes.reduce((n,i)=>n+i,0);this.sizes=this.sizes.map(n=>n*t),this.split=Ui(this.dom.children,{direction:this.direction,gutterSize:2,sizes:this.sizes,onDragEnd:n=>this.sizes=n})}convertPaneToSplit(t){const n=this.getChildIndex(t),i=this.children.splice(n,1)[0],r=this.createSplit({children:[i,"empty"],sizes:[50,50]});this.children.splice(n,0,r),i.dom.replaceWith(r.dom),this.updateSplit(),this.manager.sync()}insertChild(t,n){this.children.splice(n+1,0,t),this.children[n].dom.after(t.dom),this.sizes.splice(n,0,this.sizes[n]),this.updateSplit(),this.manager.sync()}oppositeAxis(){return this.direction=="horizontal"?"vertical":"horizontal"}getChildIndex(t){return this.children.findIndex(n=>n.id==t)}collapseSplitGroup(t,n){const i=this.getChildIndex(t);if(n instanceof ne){const r=this.createPane({id:n.id,paneDom:n.paneDom});this.children.splice(i,1,r)[0].dom.replaceWith(r.dom)}else if(n instanceof yt){const r=n.children.map(l=>{if(l instanceof ne)return this.createPane({id:l.id,paneDom:l.paneDom});if(l instanceof yt)return this.adoptSplit(l);console.error("Error collapsing SplitGroup: Encountered grandchild that is not a Pane or SplitGroup")});this.children.splice(i,1,...r)[0].dom.replaceWith(...r.map(l=>l.dom));const a=n.sizes.map(l=>l*this.sizes[i]/100);this.sizes.splice(i,1,...a)}this.updateSplit()}closePane(t){if(this.id=="root"&&this.children.length==1)return;const n=this.getChildIndex(t),i=this.children.splice(n,1)[0];this.sizes.splice(n,1)[0],this.manager.removePane(i),this.children.length==1&&this.id!="root"?this.collapse(this.children[0]):this.updateSplit()}saveLayout(){return{sizes:this.sizes,children:this.children.map(t=>t.saveLayout())}}}class qi{constructor(t,n,i,r){this.currentPaneID=0,this.paneMap={},this.sync=()=>i(this.paneMap),this.initPane=r,this.paneEvents={ondrop:(s,o)=>this.onDropInPane(s,o),ondragover:(s,o)=>this.onDragOverPane(s,o),ondragenter:(s,o)=>this.onDragEnterPane(s,o),ondragleave:(s,o)=>this.onDragLeavePane(s,o),ondragstart:(s,o)=>this.onStartDragPane(s,o)},this.loadLayout(t),n.appendChild(this.root.dom)}registerPane(t){const n=`pane-${this.currentPaneID}`;return this.currentPaneID++,this.paneMap[n]=t,n}removePane(t){t.dom.remove(),delete this.paneMap[t.id]}onStartDragPane(t,n){t.dataTransfer.setData("pane-data",this.paneMap[n]),t.dataTransfer.setData("source-pane",n),t.dataTransfer.setDragImage(t.currentTarget,10,10)}onDropInPane(t,n){t.preventDefault(),t.currentTarget.classList.remove("targeted");const i=t.dataTransfer.getData("pane-data"),r=t.dataTransfer.getData("pane-type"),s=t.dataTransfer.getData("source-pane");s&&(this.paneMap[s]=this.paneMap[n]),this.paneMap[n]=i,this.initPane(n,i,r),s&&this.initPane(s,this.paneMap[s],r),this.sync()}onDragOverPane(t,n){t.preventDefault()}onDragEnterPane(t,n){t.currentTarget.classList.contains("dropzone")&&t.currentTarget.classList.add("targeted")}onDragLeavePane(t,n){t.currentTarget.contains(t.relatedTarget)||t.currentTarget.classList.contains("dropzone")&&t.currentTarget.classList.remove("targeted")}saveLayout(){return console.log(this.paneMap),this.root.saveLayout()}loadLayout(t){this.currentPaneID=0,this.paneMap={},this.root=new yt(t.children,this,{id:"root",sizes:t.sizes})}attachPaneDropData(t,n,i){typeof n!="string"&&console.warn("Warning: I haven't tried non-string pane data"),t.dataTransfer.setData("pane-data",n),t.dataTransfer.setData("pane-type",i)}}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var Ae;const ce=window,$t=ce.trustedTypes,cn=$t?$t.createPolicy("lit-html",{createHTML:e=>e}):void 0,Ee="$lit$",st=`lit$${(Math.random()+"").slice(9)}$`,Bn="?"+st,Gi=`<${Bn}>`,pt=document,Ht=()=>pt.createComment(""),Vt=e=>e===null||typeof e!="object"&&typeof e!="function",Un=Array.isArray,Ki=e=>Un(e)||typeof(e==null?void 0:e[Symbol.iterator])=="function",Se=`[ 	
\f\r]`,Et=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,un=/-->/g,fn=/>/g,ht=RegExp(`>|${Se}(?:([^\\s"'>=/]+)(${Se}*=${Se}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),dn=/'/g,pn=/"/g,qn=/^(?:script|style|textarea|title)$/i,Wi=e=>(t,...n)=>({_$litType$:e,strings:t,values:n}),ot=Wi(1),Yt=Symbol.for("lit-noChange"),T=Symbol.for("lit-nothing"),_n=new WeakMap,ut=pt.createTreeWalker(pt,129,null,!1);function Gn(e,t){if(!Array.isArray(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return cn!==void 0?cn.createHTML(t):t}const Zi=(e,t)=>{const n=e.length-1,i=[];let r,s=t===2?"<svg>":"",o=Et;for(let a=0;a<n;a++){const l=e[a];let h,c,f=-1,d=0;for(;d<l.length&&(o.lastIndex=d,c=o.exec(l),c!==null);)d=o.lastIndex,o===Et?c[1]==="!--"?o=un:c[1]!==void 0?o=fn:c[2]!==void 0?(qn.test(c[2])&&(r=RegExp("</"+c[2],"g")),o=ht):c[3]!==void 0&&(o=ht):o===ht?c[0]===">"?(o=r??Et,f=-1):c[1]===void 0?f=-2:(f=o.lastIndex-c[2].length,h=c[1],o=c[3]===void 0?ht:c[3]==='"'?pn:dn):o===pn||o===dn?o=ht:o===un||o===fn?o=Et:(o=ht,r=void 0);const u=o===ht&&e[a+1].startsWith("/>")?" ":"";s+=o===Et?l+Gi:f>=0?(i.push(h),l.slice(0,f)+Ee+l.slice(f)+st+u):l+st+(f===-2?(i.push(void 0),a):u)}return[Gn(e,s+(e[n]||"<?>")+(t===2?"</svg>":"")),i]};class Xt{constructor({strings:t,_$litType$:n},i){let r;this.parts=[];let s=0,o=0;const a=t.length-1,l=this.parts,[h,c]=Zi(t,n);if(this.el=Xt.createElement(h,i),ut.currentNode=this.el.content,n===2){const f=this.el.content,d=f.firstChild;d.remove(),f.append(...d.childNodes)}for(;(r=ut.nextNode())!==null&&l.length<a;){if(r.nodeType===1){if(r.hasAttributes()){const f=[];for(const d of r.getAttributeNames())if(d.endsWith(Ee)||d.startsWith(st)){const u=c[o++];if(f.push(d),u!==void 0){const g=r.getAttribute(u.toLowerCase()+Ee).split(st),p=/([.?@])?(.*)/.exec(u);l.push({type:1,index:s,name:p[2],strings:g,ctor:p[1]==="."?Qi:p[1]==="?"?tr:p[1]==="@"?er:ye})}else l.push({type:6,index:s})}for(const d of f)r.removeAttribute(d)}if(qn.test(r.tagName)){const f=r.textContent.split(st),d=f.length-1;if(d>0){r.textContent=$t?$t.emptyScript:"";for(let u=0;u<d;u++)r.append(f[u],Ht()),ut.nextNode(),l.push({type:2,index:++s});r.append(f[d],Ht())}}}else if(r.nodeType===8)if(r.data===Bn)l.push({type:2,index:s});else{let f=-1;for(;(f=r.data.indexOf(st,f+1))!==-1;)l.push({type:7,index:s}),f+=st.length-1}s++}}static createElement(t,n){const i=pt.createElement("template");return i.innerHTML=t,i}}function At(e,t,n=e,i){var r,s,o,a;if(t===Yt)return t;let l=i!==void 0?(r=n._$Co)===null||r===void 0?void 0:r[i]:n._$Cl;const h=Vt(t)?void 0:t._$litDirective$;return(l==null?void 0:l.constructor)!==h&&((s=l==null?void 0:l._$AO)===null||s===void 0||s.call(l,!1),h===void 0?l=void 0:(l=new h(e),l._$AT(e,n,i)),i!==void 0?((o=(a=n)._$Co)!==null&&o!==void 0?o:a._$Co=[])[i]=l:n._$Cl=l),l!==void 0&&(t=At(e,l._$AS(e,t.values),l,i)),t}class Ji{constructor(t,n){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=n}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){var n;const{el:{content:i},parts:r}=this._$AD,s=((n=t==null?void 0:t.creationScope)!==null&&n!==void 0?n:pt).importNode(i,!0);ut.currentNode=s;let o=ut.nextNode(),a=0,l=0,h=r[0];for(;h!==void 0;){if(a===h.index){let c;h.type===2?c=new Gt(o,o.nextSibling,this,t):h.type===1?c=new h.ctor(o,h.name,h.strings,this,t):h.type===6&&(c=new nr(o,this,t)),this._$AV.push(c),h=r[++l]}a!==(h==null?void 0:h.index)&&(o=ut.nextNode(),a++)}return ut.currentNode=pt,s}v(t){let n=0;for(const i of this._$AV)i!==void 0&&(i.strings!==void 0?(i._$AI(t,i,n),n+=i.strings.length-2):i._$AI(t[n])),n++}}class Gt{constructor(t,n,i,r){var s;this.type=2,this._$AH=T,this._$AN=void 0,this._$AA=t,this._$AB=n,this._$AM=i,this.options=r,this._$Cp=(s=r==null?void 0:r.isConnected)===null||s===void 0||s}get _$AU(){var t,n;return(n=(t=this._$AM)===null||t===void 0?void 0:t._$AU)!==null&&n!==void 0?n:this._$Cp}get parentNode(){let t=this._$AA.parentNode;const n=this._$AM;return n!==void 0&&(t==null?void 0:t.nodeType)===11&&(t=n.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,n=this){t=At(this,t,n),Vt(t)?t===T||t==null||t===""?(this._$AH!==T&&this._$AR(),this._$AH=T):t!==this._$AH&&t!==Yt&&this._(t):t._$litType$!==void 0?this.g(t):t.nodeType!==void 0?this.$(t):Ki(t)?this.T(t):this._(t)}k(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}$(t){this._$AH!==t&&(this._$AR(),this._$AH=this.k(t))}_(t){this._$AH!==T&&Vt(this._$AH)?this._$AA.nextSibling.data=t:this.$(pt.createTextNode(t)),this._$AH=t}g(t){var n;const{values:i,_$litType$:r}=t,s=typeof r=="number"?this._$AC(t):(r.el===void 0&&(r.el=Xt.createElement(Gn(r.h,r.h[0]),this.options)),r);if(((n=this._$AH)===null||n===void 0?void 0:n._$AD)===s)this._$AH.v(i);else{const o=new Ji(s,this),a=o.u(this.options);o.v(i),this.$(a),this._$AH=o}}_$AC(t){let n=_n.get(t.strings);return n===void 0&&_n.set(t.strings,n=new Xt(t)),n}T(t){Un(this._$AH)||(this._$AH=[],this._$AR());const n=this._$AH;let i,r=0;for(const s of t)r===n.length?n.push(i=new Gt(this.k(Ht()),this.k(Ht()),this,this.options)):i=n[r],i._$AI(s),r++;r<n.length&&(this._$AR(i&&i._$AB.nextSibling,r),n.length=r)}_$AR(t=this._$AA.nextSibling,n){var i;for((i=this._$AP)===null||i===void 0||i.call(this,!1,!0,n);t&&t!==this._$AB;){const r=t.nextSibling;t.remove(),t=r}}setConnected(t){var n;this._$AM===void 0&&(this._$Cp=t,(n=this._$AP)===null||n===void 0||n.call(this,t))}}class ye{constructor(t,n,i,r,s){this.type=1,this._$AH=T,this._$AN=void 0,this.element=t,this.name=n,this._$AM=r,this.options=s,i.length>2||i[0]!==""||i[1]!==""?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=T}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(t,n=this,i,r){const s=this.strings;let o=!1;if(s===void 0)t=At(this,t,n,0),o=!Vt(t)||t!==this._$AH&&t!==Yt,o&&(this._$AH=t);else{const a=t;let l,h;for(t=s[0],l=0;l<s.length-1;l++)h=At(this,a[i+l],n,l),h===Yt&&(h=this._$AH[l]),o||(o=!Vt(h)||h!==this._$AH[l]),h===T?t=T:t!==T&&(t+=(h??"")+s[l+1]),this._$AH[l]=h}o&&!r&&this.j(t)}j(t){t===T?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}}class Qi extends ye{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===T?void 0:t}}const ji=$t?$t.emptyScript:"";class tr extends ye{constructor(){super(...arguments),this.type=4}j(t){t&&t!==T?this.element.setAttribute(this.name,ji):this.element.removeAttribute(this.name)}}class er extends ye{constructor(t,n,i,r,s){super(t,n,i,r,s),this.type=5}_$AI(t,n=this){var i;if((t=(i=At(this,t,n,0))!==null&&i!==void 0?i:T)===Yt)return;const r=this._$AH,s=t===T&&r!==T||t.capture!==r.capture||t.once!==r.once||t.passive!==r.passive,o=t!==T&&(r===T||s);s&&this.element.removeEventListener(this.name,this,r),o&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var n,i;typeof this._$AH=="function"?this._$AH.call((i=(n=this.options)===null||n===void 0?void 0:n.host)!==null&&i!==void 0?i:this.element,t):this._$AH.handleEvent(t)}}class nr{constructor(t,n,i){this.element=t,this.type=6,this._$AN=void 0,this._$AM=n,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(t){At(this,t)}}const gn=ce.litHtmlPolyfillSupport;gn==null||gn(Xt,Gt),((Ae=ce.litHtmlVersions)!==null&&Ae!==void 0?Ae:ce.litHtmlVersions=[]).push("2.7.5");const Mt=(e,t,n)=>{var i,r;const s=(i=n==null?void 0:n.renderBefore)!==null&&i!==void 0?i:t;let o=s._$litPart$;if(o===void 0){const a=(r=n==null?void 0:n.renderBefore)!==null&&r!==void 0?r:null;s._$litPart$=o=new Gt(t.insertBefore(Ht(),a),a,void 0,n??{})}return o._$AI(e),o};class J{constructor(t,n,i,r){if(r){if(Math.log2(t.length)>r)throw new Error("Error creating Palette: too many entries for specified bit depth");this.bitDepth=r}else this.bitDepth=Math.ceil(Math.log2(t.length));this.entries=t.map(s=>{if(typeof s!=typeof t[0])throw new Error("All palette entries must be the same type!");return s}),this.scale=n??[1,1],this.drawFunc=i}addEntry(t){this.entries.push(t)}static getRGB([t,n,i]){try{return`rgb(${t} ${n} ${i})`}catch{return console.warn("Can't destructure palette entries to RGB"),"rgb(0 0 0)"}}getRGBA(t){try{const[n,i,r,s]=this.entries[t];return`rgb(${n} ${i} ${r} / ${s})`}catch{return console.warn("Can't destructure palette entries to RGBA"),"rgb(0 0 0 / 0)"}}draw(t,n,i,r){try{this.drawFunc(n,this.entries[t],i,r,t)}catch(s){console.error("Error in palette draw function!",s)}}}class me extends J{constructor(t){super(t,[1,1]),this.drawFunc=this.drawPixel}drawPixel(t,n,i,r){t.fillStyle=J.getRGB(n),t.fillRect(0,0,1,1)}}const Kt=[[0,0,0],[255,255,255]],ir=[[0,0,0],[1,0,0],[0,1,0],[0,0,1]],rr=[[0,0,0],[255,0,0],[0,255,0],[0,0,255],[255,0,255],[255,255,0],[0,255,255],[255,255,255]],sr=[[0,0,0],[1,0,0],[0,1,0],[0,0,1],[1,0,1],[1,1,0],[0,1,1],[1,1,1],[0,0,0],[1,0,0],[0,1,0],[0,0,1],[1,0,1],[1,1,0],[0,1,1],[1,1,1]];function or(e,t,n,i){e.fillStyle=J.getRGB(t),e.beginPath(),e.arc(this.scale[0]/2,this.scale[1]/2,Math.abs(this.scale[0]/2-n),0,2*Math.PI),e.fill()}function Ne(e,t,n,i,r){const s=e.createLinearGradient(t[0],t[1],n[0],n[1]);return s.addColorStop(0,i),s.addColorStop(1,r),s}function ar(e,t,n,i,r){e.lineWidth=18,e.lineCap="round",e.strokeStyle="#ff9e0d",e.fillStyle="#404040",this.scale[0]/4,3*this.scale/4,e.fillRect(0,0,this.scale[0],this.scale[0]);const s="#ff9e0d",o="#cf7e06";if(r==0){const a=[0,85],l=[40,60],h=Ne(e,a,l,o,s);e.strokeStyle=h,e.beginPath(),e.moveTo(a[0],a[1]),e.bezierCurveTo(25,85,30,75,l[0],l[1]),e.stroke();const c=[100,85],f=[60,60],d=Ne(e,c,f,o,s);e.strokeStyle=d,e.beginPath(),e.moveTo(c[0],c[1]),e.bezierCurveTo(75,85,70,75,f[0],f[1]),e.stroke();const u=Ne(e,[50,25],[50,75],o,s);e.strokeStyle=u,e.beginPath(),e.moveTo(20,100),e.bezierCurveTo(0,0,100,0,80,100),e.stroke(),e.strokeStyle=s,e.beginPath(),e.moveTo(l[0],l[1]),e.bezierCurveTo(50,20,20,20,20,0),e.stroke(),e.beginPath(),e.moveTo(f[0],f[1]),e.bezierCurveTo(50,20,80,20,80,0),e.stroke()}else r==1&&(e.strokeStyle=o,e.beginPath(),e.moveTo(0,85),e.lineTo(100,85),e.stroke(),e.strokeStyle=s,e.beginPath(),e.moveTo(20,100),e.lineTo(20,0),e.stroke(),e.beginPath(),e.moveTo(80,100),e.lineTo(80,0),e.stroke())}function lr(e,t){e.fillStyle=J.getRGB(t),e.fillRect(0,0,1,1)}new J(Kt,[20,20]);new J(ir,[20,20]);new J(sr,[20,20]);const mt=new me(Kt);new me([[0,87,72],[91,240,203],[0,0,0],[0,255,255]]);new me(rr);new J(Kt,[100,100],or);new J(Kt,[100,100],ar);new J(Kt,[1,1],lr);class q{constructor(t,n,i){this.width=t,this.height=n,this.pixels=new Uint8ClampedArray(i)}static empty(t,n,i){let r=new Array(t*n).fill(i);return new q(t,n,r)}static fromTile(t,n,i){let r=[];for(let s=0;s<n;s++)for(let o=0;o<t;o++)r.push(i.pixel(o%i.width,s%i.height));return new q(t,n,r)}static fromImage(t){const n=document.createElement("canvas"),i=n.getContext("2d"),r=t.width,s=t.height;n.width=r,n.height=s,i.drawImage(t,0,0);const o=i.getImageData(0,0,r,s).data,a=[],l={},h=[];for(let d=0;d<o.length;d+=4){const u=[o[d],o[d+1],o[d+2]],g=u.toString();g in l||(a.push(u),l[g]=a.length-1),h.push(l[g])}const c=new me(a);return{bitmap:new q(r,s,h),palette:c}}resize(t,n){let i=[];for(let r=0;r<n;r++)for(let s=0;s<t;s++)r>=this.height||s>=this.width?i.push(0):i.push(this.pixel(s,r));return new q(t,n,i)}make2d(){let t=Array.from(this.pixels).slice(),n=[];for(;t.length>0;)n.push(t.splice(0,this.width));return n}vMirror(){return this.make2d().map(t=>t.toReversed()).flat()}pixel(t,n){return t>this.width-1||t<0||n>this.height-1||n<0?-1:this.pixels.at(t+n*this.width)}draw(t){let n=this.pixels.slice();for(let{x:i,y:r,color:s}of t)n[i+r*this.width]=s;return new q(this.width,this.height,n)}brush({x:t,y:n},i){let r={x:t,y:n,color:i};return this.draw([r])}flood({x:t,y:n},i){const r=[{dx:-1,dy:0},{dx:1,dy:0},{dx:0,dy:-1},{dx:0,dy:1}];let s=this.pixel(t,n),o=[{x:t,y:n,color:i}];for(let a=0;a<o.length;a++)for(let{dx:l,dy:h}of r){let c=o[a].x+l,f=o[a].y+h;c>=0&&c<this.width&&f>=0&&f<this.height&&this.pixel(c,f)==s&&!o.some(d=>d.x==c&&d.y==f)&&o.push({x:c,y:f,color:i})}return this.draw(o)}rect(t,n,i){let r=Math.min(t.x,n.x),s=Math.min(t.y,n.y),o=Math.max(t.x,n.x),a=Math.max(t.y,n.y),l=[];for(let h=s;h<=a;h++)for(let c=r;c<=o;c++)l.push({x:c,y:h,color:i});return this.draw(l)}line(t,n,i){let r=[];if(Math.abs(t.x-n.x)>Math.abs(t.y-n.y)){t.x>n.x&&([t,n]=[n,t]);let s=(n.y-t.y)/(n.x-t.x);for(let{x:o,y:a}=t;o<=n.x;o++)r.push({x:o,y:Math.round(a),color:i}),a+=s}else{t.y>n.y&&([t,n]=[n,t]);let s=(n.x-t.x)/(n.y-t.y);for(let{x:o,y:a}=t;a<=n.y;a++)r.push({x:Math.round(o),y:a,color:i}),o+=s}return this.draw(r)}}class ke{constructor(t,n){this.bitmap=null,this.palette=n,this.offscreenCanvas=new OffscreenCanvas(t.width*this.palette.scale[0],t.height*this.palette.scale[1]),this.ctx=this.offscreenCanvas.getContext("2d"),this.updateOffscreenCanvas(t,n)}updateOffscreenCanvas(t,n){this.bitmap!=t&&(this.draw(t,n),this.bitmap=t,this.palette=n)}transferOffscreenToCanvas(t){if(!(!this.bitmap||this.bitmap.width==0||this.bitmap.height==0)){t.width=this.bitmap.width*this.palette.scale[0],t.height=this.bitmap.height*this.palette.scale[1];try{const n=t.getContext("2d");n.clearRect(0,0,n.canvas.width,n.canvas.height),n.drawImage(this.offscreenCanvas,0,0)}catch{console.log("error drawing to canvas")}}}draw(t,n){(this.bitmap==null||this.bitmap.width!=t.width||this.bitmap.height!=t.height)&&(this.offscreenCanvas.width=t.width*this.palette.scale[0],this.offscreenCanvas.height=t.height*this.palette.scale[1],this.bitmap=null);for(let i=0;i<t.height;i++)for(let r=0;r<t.width;r++){let s=t.pixel(r,i);(this.bitmap==null||this.bitmap.pixel(r,i)!=s)&&(this.ctx.translate(r*this.palette.scale[0],i*this.palette.scale[1]),n.draw(s,this.ctx,r,i),this.ctx.setTransform(1,0,0,1,0,0))}}}const hr={triangle:[0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,1,0,1,0,1,0,0,0,0,0,0,0,1,0,1,0,1,0,0,0,0,0,0,0,1,0,1,0,1,0,0,0,0,0,0,0,1,0,1,1,0,1,0,0,0,0,0,1,0,1,0,1,0,1,0,0,0,0,0,1,0,1,0,1,0,1,0,0,0,0,0,1,0,1,0,1,0,1,0,0,0,0,0,1,0,1,0,0,1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,1,0,1,0,1,0,0,0,0,0,0,0,1,0,1,0,1,0,0,0,0,0,0,0,1,0,1,0,1,0,0,0,0,0,0,0,1,0,1,0,1,0,0,0,0,0,0,1,0,1,0,1,0,1,0,0,0,0,0,1,0,1,0,1,0,1,0,0,0,0,0,1,0,1,0,1,0,1,0,0,0,0,0,1,0,1,0,1,0,1,0,0,0,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,0],beetle:[0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,1,1,0,1,0,0,0,0,0,0,1,0,1,0,1,1,1,1,0,1,1,0,0,0,0,0,1,0,1,0,1,1,0,1,0,1,0,1,1,0,1,0,0,0,1,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,1,0,1,1,1,0]},Kn=e=>e.composedPath()[0],cr=(e,t)=>Kn(e).matches(t),Wn=e=>(t,n,i,r)=>{e.addEventListener(t,s=>{s.trigger=Kn(s),(n===""||cr(s,n))&&i(s)},r??{})},Zn=(e,t)=>{const n=document.createElement("canvas");n.width=e.width,n.height=e.height;const i=n.getContext("2d"),r=e.toImageData(t);return i.putImageData(r,0,0),n},ur=(e,t)=>Zn(e,t).toDataURL("image/jpeg",1),fr=(e,t)=>Zn(e,t).toDataURL("image/png"),dr=(e,t)=>{const n={pixels:e.pixels,width:e.width,height:e.height,palette:t};return"data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(n))},pr=(e,t)=>{const n=`SilverKnit
`+e.make2d().map(i=>i.join("")).join(`
`);return"data:text/plain;charset=utf-8,"+encodeURIComponent(n)},ze={txt:pr,json:dr,png:fr,jpg:ur};let ie=null;function _r(e,t){const n=(function(){}).constructor,i=Object.keys(e),r=Object.values(e);return new n(...i,t)(...r)}function vn(e,t){t||(t=0);const n=[...e],i=[];for(let r=0;r<n.length;r++){const s=n[r];if(r<t)i.push(s.bitmap);else if(s.type=="code"){let o;try{o=_r({Bimp:q,layers:i},s.program),i.push(o),s.bitmap=o}catch(a){console.log("Error in layer",r),console.error(a)}}else i.push(s.bitmap);s.canvas.updateOffscreenCanvas(s.bitmap,s.palette)}return n}const gr={undo:e=>e.history.length===0?{}:{changes:{bitmap:e.history[0],history:e.history.slice(1)}},addCodeLayer:(e,t,n)=>{const i=q.empty(10,10,0),r=[...e.layers];r.push({id:"testcode",type:"code",bitmap:i,palette:mt,program:`const width = 10;
const height = 10;
const pixels = new Array(width * height).fill(0);

return new Bimp(width, height, pixels);`,canvas:new ke(i,mt)});const s=e.layers.length;return{changes:{layers:vn(r)},postRender:()=>{n("setActiveLayer",s)}}},newMotif:(e,t,n)=>{const i=q.empty(10,10,0),r={...e.motifs};return r[`motif${e.motifCounter}`]={bitmap:i,bimpCanvas:new ke(i,mt),palette:mt},{changes:{motifs:r,motifCounter:e.motifCounter+1}}},refreshCanvas:e=>{const t=[...e.layers];return t.forEach(n=>{n.canvas.bitmap=null,n.canvas.updateOffscreenCanvas(n.bitmap,n.palette)}),{changes:{layers:t}}},updateColor:(e,{paletteIndex:t,index:n,newVal:i},r)=>{const s=[...e.layers];let o=s[e.activeLayer].palette;return o.entries[t][n]=Number(i),s[e.activeLayer].palette=o,{changes:{layers:s},postRender:()=>r("refreshCanvas")}},executeTimeout:(e,t,n)=>(ie&&clearTimeout(ie),ie=setTimeout(()=>n("execute"),500),{changes:{}}),execute:e=>(ie=null,{changes:{layers:vn(e.layers)}}),setProgram:(e,{program:t},n)=>{const i=[...e.layers];return i[e.activeLayer].program=t,{changes:{layers:i},postRender:()=>n("executeTimeout")}},editMotif:(e,{bitmap:t,motifID:n},i)=>{const r={...e.motifs},s=r[n];return s.bitmap=t,s.bimpCanvas.updateOffscreenCanvas(s.bitmap,s.palette),{changes:{motifs:r}}},snapshot:e=>(console.log("SNAP"),{changes:{}}),resizeMotif:(e,[t,n,i],r)=>{const s={...e.motifs};return s[i].bitmap=s[i].bitmap.resize(t,n),{changes:{motifs:s}}},copyPixelArray:e=>(navigator.clipboard.writeText(e.layers[e.activeLayer].bitmap.pixels),{changes:{}}),download:(e,t)=>{if(!ze.hasOwnProperty(t)){console.log("Oops! I don't know how to export to",t);return}const n=e.layers[e.activeLayer];let i=document.createElement("a");return i.setAttribute("href",ze[t](n.bitmap,n.palette)),i.setAttribute("download",`${e.title}.${t}`),i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),{changes:{}}}},Pe="ECN",Pt="PCN",gt="ACN",kt="UACN",vr="K",yr="P",yn="T",mn="M";class mr{constructor(t,n,i=!0){if(this.width=2*t,this.height=n+1,this.contacts=Array.from({length:this.width*this.height},()=>[null,Pe,[null,null]]),i)for(let r=0;r<this.width;r++)this.setAV(r,0,Pt),this.setMV(r,0,[0,0])}getST(t,n){return this.neighborhood(t,n)[0]}setSt(t,n,i){this.neighborhood(t,n)[0]=i}getAV(t,n){return this.neighborhood(t,n)[1]}setAV(t,n,i){this.neighborhood(t,n)[1]=i}getMV(t,n){return this.neighborhood(t,n)[2]}getDeltaI(t,n){return this.neighborhood(t,n)[2][0]}getDeltaJ(t,n){return this.neighborhood(t,n)[2][1]}setMV(t,n,i){this.neighborhood(t,n)[2]=i}setDeltaJ(t,n,i){this.neighborhood(t,n)[2][1]=i}setDeltaI(t,n,i){this.neighborhood(t,n)[2][0]=i}neighborhood(t,n){return this.contacts[n*this.width+t]}}class wr{constructor(t){this.instructions=t,this.width=t.width,this.height=t.height,this.cn=new mr(this.width,this.height),this.populateContacts()}handleKPLower(t,n,i){this.cn.setSt(t,n,i);const r=this.cn.getAV(t,n),s=this.cn.getMV(t,n);r==Pt&&s[0]===0&&this.cn.setAV(t,n,gt),r==kt&&((this.cn.getAV(t+1,n-1)==gt&&this.cn.getMV(t+1,n-1)[1]==0||this.cn.getAV(t-1,n-1)==gt&&this.cn.getMV(t-1,n-1)[1]==0)&&this.cn.setAV(t,n,gt),this.cn.getAV(t,n-1)==Pt&&this.cn.setAV(t,n-1,gt))}handleKPUpper(t,n){this.cn.setMV(t,n+1,[0,0]),this.cn.getAV(t,n)==gt?this.cn.setAV(t,n+1,Pt):this.cn.setAV(t,n+1,kt),this.cn.getAV(t,n)==kt}handleTuckMissUpper(t,n,i){i==yn?(this.cn.setAV(t,n+1,kt),this.cn.setMV(t,n+1,[0,0])):i==mn&&(this.cn.setAV(t,n+1,Pe),this.cn.setMV(t,n+1,[0,-1]))}handleTuckMissLower(t,n,i){const r=this.cn.getAV(t,n);if(r==Pt||r==kt)this.cn.setDeltaJ(t,n,1);else if(r==Pe){let s=!1,o=0;for(;!s;){const a=this.cn.getMV(t,n-o)[1];a>0&&(this.cn.setDeltaJ(t,n-o,a+1),s=!0)}}}handleOp(t,n,i,r){(i==vr||i==yr)&&(this.handleKPLower(t,n,i),this.handleKPLower(t+r,n,i),this.handleKPUpper(t,n,i),this.handleKPUpper(t+r,n,i)),(i==yn||i==mn)&&(this.handleTuckMissLower(t,n,i),this.handleTuckMissLower(t+r,n,i),this.handleTuckMissUpper(t,n,i),this.handleTuckMissUpper(t+r,n,i))}processRow(t,n){if(n)for(let i=0;i<this.width;i++){const r=this.instructions.op(i,t);this.handleOp(2*i,t,r,1)}else for(let i=this.width-1;i>=0;i--){const r=this.instructions.op(i,t);this.handleOp(2*i+1,t,r,-1)}}populateContacts(){let t=!0;for(let n=0;n<this.height;n++)this.processRow(n,t),t=!t}}const xr={T:0,K:1,S:2},br=["K","T","S"];class $r{constructor(t){this.width=t.width,this.height=t.height,this.ops=Array.from(t.vMirror()).map(n=>br[n]).toReversed()}op(t,n){return t>this.width-1||t<0||n>this.height-1||n<0?-1:this.ops.at(t+n*this.width)}makeOpData(){const t=this.width,n=this.height,i=[];for(let r=0;r<n;r++)for(let s=0;s<t;s++){const o=r*t+s,a=this.op(s,r),l=[[2*s,r],[2*s+1,r],[2*s+1,r+1],[2*s,r+1]];i.push({index:o,stitch:a,op:xr[a],cnIndices:l.map(([h,c])=>c*2*t+h)})}return i}}const Jn="K",Qn="P",Ar="ECN",wn="ACN",Sr="UACN";function Nr(e){let t=0,n=0,i=!0,r=0;const s=[];for(;n<e.height;){const o=r%2==0,a=t%2==0,l=o===a?"F":"L";if(Mr(t,n,i,s,e)){let h;if(i)h=[t,n,r,l+"L"];else{const c=jn(t,n,e);h=[c.i,c.j,r,l+"H"]}s.push(h)}({i:t,j:n,legNode:i,currentStitchRow:r}=ti(t,n,i,r,e))}return s}function Mr(e,t,n,i,r){if(n)return r.getST(e,t)==Jn||r.getST(e,t)==Qn;{let s=r.getAV(e,t);if(s==Ar)return!1;if(s==Sr){let o,a,l,h;if(e%2==0&&t%2!=0)[o,a,l,h]=i.at(-1);else{let f=!1,d=e,u=t,g=n,p=t-1;for(;!f;){const _=ti(d,u,g,p,r);r.getAV(_.i,_.j)==wn&&(f=!0),d=_.i,u=_.j,g=_.legNode,p=_.currentStitchRow}o=d,a=u}const c=jn(e,t,r);return a<c.j?(r.setAV(e,t,wn),!0):!1}else return!0}}function jn(e,t,n){const[i,r]=n.getMV(e,t);return t==n.height-1?{i:e,j:t}:i!=0?Ie(e+i,t,n):Ie(e,t+r,n)}function Ie(e,t,n){return n.getST(e,t)==Jn||n.getST(e,t)==Qn?{i:e,j:t}:t==n.height-1?{i:e,j:t}:Ie(e,t+n.getDeltaJ(e,t),n)}function ti(e,t,n,i,r){const s=i%2==0,o=e%2==0;let a=e,l=t,h=n;return n?s?o?(l=t+1,h=!1):a=e+1:o?a=e-1:(l=t+1,h=!1):s?o?a=e+1:(l=t-1,h=!0):o?(l=t-1,h=!0):a=e-1,a<0||a>=r.width?{i:e,j:t+1,legNode:!0,currentStitchRow:i+1}:{i:a,j:l,legNode:h,currentStitchRow:i}}class Cr{constructor(t){this.width=t.width,this.height=t.height,this.cns=t,this.contactNodes=t.contacts.map((n,i)=>({index:i,st:n[0],cn:n[1],mv:n[2]})),this.yarnPath=Nr(t)}yarnPathToLinks(){let t=0,n=this.yarnPath[0][3];const i=[];return this.yarnPath.forEach(([r,s,o,a],l)=>{if(l==0)return;let h=s*this.width+r;i.push({source:t,target:h,row:o,linkType:n+a}),t=h,n=a}),i}makeNice(){return this.yarnPath.map(([t,n,i,r])=>({cnIndex:n*this.width+t,i:t,j:n,row:i,cnType:r,angle:null,normal:[0,0]}))}}var Tr={value:()=>{}};function qe(){for(var e=0,t=arguments.length,n={},i;e<t;++e){if(!(i=arguments[e]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new ae(n)}function ae(e){this._=e}function Er(e,t){return e.trim().split(/^|\s+/).map(function(n){var i="",r=n.indexOf(".");if(r>=0&&(i=n.slice(r+1),n=n.slice(0,r)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}ae.prototype=qe.prototype={constructor:ae,on:function(e,t){var n=this._,i=Er(e+"",n),r,s=-1,o=i.length;if(arguments.length<2){for(;++s<o;)if((r=(e=i[s]).type)&&(r=kr(n[r],e.name)))return r;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++s<o;)if(r=(e=i[s]).type)n[r]=xn(n[r],e.name,t);else if(t==null)for(r in n)n[r]=xn(n[r],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new ae(e)},call:function(e,t){if((r=arguments.length-2)>0)for(var n=new Array(r),i=0,r,s;i<r;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(s=this._[e],i=0,r=s.length;i<r;++i)s[i].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],r=0,s=i.length;r<s;++r)i[r].value.apply(t,n)}};function kr(e,t){for(var n=0,i=e.length,r;n<i;++n)if((r=e[n]).name===t)return r.value}function xn(e,t,n){for(var i=0,r=e.length;i<r;++i)if(e[i].name===t){e[i]=Tr,e=e.slice(0,i).concat(e.slice(i+1));break}return n!=null&&e.push({name:t,value:n}),e}var Le="http://www.w3.org/1999/xhtml";const bn={svg:"http://www.w3.org/2000/svg",xhtml:Le,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function we(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),bn.hasOwnProperty(t)?{space:bn[t],local:e}:e}function zr(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===Le&&t.documentElement.namespaceURI===Le?t.createElement(e):t.createElementNS(n,e)}}function Pr(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function ei(e){var t=we(e);return(t.local?Pr:zr)(t)}function Ir(){}function Ge(e){return e==null?Ir:function(){return this.querySelector(e)}}function Lr(e){typeof e!="function"&&(e=Ge(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var s=t[r],o=s.length,a=i[r]=new Array(o),l,h,c=0;c<o;++c)(l=s[c])&&(h=e.call(l,l.__data__,c,s))&&("__data__"in l&&(h.__data__=l.__data__),a[c]=h);return new V(i,this._parents)}function Dr(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function Rr(){return[]}function ni(e){return e==null?Rr:function(){return this.querySelectorAll(e)}}function Or(e){return function(){return Dr(e.apply(this,arguments))}}function Hr(e){typeof e=="function"?e=Or(e):e=ni(e);for(var t=this._groups,n=t.length,i=[],r=[],s=0;s<n;++s)for(var o=t[s],a=o.length,l,h=0;h<a;++h)(l=o[h])&&(i.push(e.call(l,l.__data__,h,o)),r.push(l));return new V(i,r)}function ii(e){return function(){return this.matches(e)}}function ri(e){return function(t){return t.matches(e)}}var Vr=Array.prototype.find;function Yr(e){return function(){return Vr.call(this.children,e)}}function Xr(){return this.firstElementChild}function Fr(e){return this.select(e==null?Xr:Yr(typeof e=="function"?e:ri(e)))}var Br=Array.prototype.filter;function Ur(){return Array.from(this.children)}function qr(e){return function(){return Br.call(this.children,e)}}function Gr(e){return this.selectAll(e==null?Ur:qr(typeof e=="function"?e:ri(e)))}function Kr(e){typeof e!="function"&&(e=ii(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var s=t[r],o=s.length,a=i[r]=[],l,h=0;h<o;++h)(l=s[h])&&e.call(l,l.__data__,h,s)&&a.push(l);return new V(i,this._parents)}function si(e){return new Array(e.length)}function Wr(){return new V(this._enter||this._groups.map(si),this._parents)}function ue(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}ue.prototype={constructor:ue,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function Zr(e){return function(){return e}}function Jr(e,t,n,i,r,s){for(var o=0,a,l=t.length,h=s.length;o<h;++o)(a=t[o])?(a.__data__=s[o],i[o]=a):n[o]=new ue(e,s[o]);for(;o<l;++o)(a=t[o])&&(r[o]=a)}function Qr(e,t,n,i,r,s,o){var a,l,h=new Map,c=t.length,f=s.length,d=new Array(c),u;for(a=0;a<c;++a)(l=t[a])&&(d[a]=u=o.call(l,l.__data__,a,t)+"",h.has(u)?r[a]=l:h.set(u,l));for(a=0;a<f;++a)u=o.call(e,s[a],a,s)+"",(l=h.get(u))?(i[a]=l,l.__data__=s[a],h.delete(u)):n[a]=new ue(e,s[a]);for(a=0;a<c;++a)(l=t[a])&&h.get(d[a])===l&&(r[a]=l)}function jr(e){return e.__data__}function ts(e,t){if(!arguments.length)return Array.from(this,jr);var n=t?Qr:Jr,i=this._parents,r=this._groups;typeof e!="function"&&(e=Zr(e));for(var s=r.length,o=new Array(s),a=new Array(s),l=new Array(s),h=0;h<s;++h){var c=i[h],f=r[h],d=f.length,u=es(e.call(c,c&&c.__data__,h,i)),g=u.length,p=a[h]=new Array(g),_=o[h]=new Array(g),y=l[h]=new Array(d);n(c,f,p,_,y,u,t);for(var x=0,S=0,w,N;x<g;++x)if(w=p[x]){for(x>=S&&(S=x+1);!(N=_[S])&&++S<g;);w._next=N||null}}return o=new V(o,i),o._enter=a,o._exit=l,o}function es(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function ns(){return new V(this._exit||this._groups.map(si),this._parents)}function is(e,t,n){var i=this.enter(),r=this,s=this.exit();return typeof e=="function"?(i=e(i),i&&(i=i.selection())):i=i.append(e+""),t!=null&&(r=t(r),r&&(r=r.selection())),n==null?s.remove():n(s),i&&r?i.merge(r).order():r}function rs(e){for(var t=e.selection?e.selection():e,n=this._groups,i=t._groups,r=n.length,s=i.length,o=Math.min(r,s),a=new Array(r),l=0;l<o;++l)for(var h=n[l],c=i[l],f=h.length,d=a[l]=new Array(f),u,g=0;g<f;++g)(u=h[g]||c[g])&&(d[g]=u);for(;l<r;++l)a[l]=n[l];return new V(a,this._parents)}function ss(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var i=e[t],r=i.length-1,s=i[r],o;--r>=0;)(o=i[r])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function os(e){e||(e=as);function t(f,d){return f&&d?e(f.__data__,d.__data__):!f-!d}for(var n=this._groups,i=n.length,r=new Array(i),s=0;s<i;++s){for(var o=n[s],a=o.length,l=r[s]=new Array(a),h,c=0;c<a;++c)(h=o[c])&&(l[c]=h);l.sort(t)}return new V(r,this._parents).order()}function as(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function ls(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function hs(){return Array.from(this)}function cs(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i=e[t],r=0,s=i.length;r<s;++r){var o=i[r];if(o)return o}return null}function us(){let e=0;for(const t of this)++e;return e}function fs(){return!this.node()}function ds(e){for(var t=this._groups,n=0,i=t.length;n<i;++n)for(var r=t[n],s=0,o=r.length,a;s<o;++s)(a=r[s])&&e.call(a,a.__data__,s,r);return this}function ps(e){return function(){this.removeAttribute(e)}}function _s(e){return function(){this.removeAttributeNS(e.space,e.local)}}function gs(e,t){return function(){this.setAttribute(e,t)}}function vs(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function ys(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function ms(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function ws(e,t){var n=we(e);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((t==null?n.local?_s:ps:typeof t=="function"?n.local?ms:ys:n.local?vs:gs)(n,t))}function oi(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function xs(e){return function(){this.style.removeProperty(e)}}function bs(e,t,n){return function(){this.style.setProperty(e,t,n)}}function $s(e,t,n){return function(){var i=t.apply(this,arguments);i==null?this.style.removeProperty(e):this.style.setProperty(e,i,n)}}function As(e,t,n){return arguments.length>1?this.each((t==null?xs:typeof t=="function"?$s:bs)(e,t,n??"")):St(this.node(),e)}function St(e,t){return e.style.getPropertyValue(t)||oi(e).getComputedStyle(e,null).getPropertyValue(t)}function Ss(e){return function(){delete this[e]}}function Ns(e,t){return function(){this[e]=t}}function Ms(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function Cs(e,t){return arguments.length>1?this.each((t==null?Ss:typeof t=="function"?Ms:Ns)(e,t)):this.node()[e]}function ai(e){return e.trim().split(/^|\s+/)}function Ke(e){return e.classList||new li(e)}function li(e){this._node=e,this._names=ai(e.getAttribute("class")||"")}li.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function hi(e,t){for(var n=Ke(e),i=-1,r=t.length;++i<r;)n.add(t[i])}function ci(e,t){for(var n=Ke(e),i=-1,r=t.length;++i<r;)n.remove(t[i])}function Ts(e){return function(){hi(this,e)}}function Es(e){return function(){ci(this,e)}}function ks(e,t){return function(){(t.apply(this,arguments)?hi:ci)(this,e)}}function zs(e,t){var n=ai(e+"");if(arguments.length<2){for(var i=Ke(this.node()),r=-1,s=n.length;++r<s;)if(!i.contains(n[r]))return!1;return!0}return this.each((typeof t=="function"?ks:t?Ts:Es)(n,t))}function Ps(){this.textContent=""}function Is(e){return function(){this.textContent=e}}function Ls(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function Ds(e){return arguments.length?this.each(e==null?Ps:(typeof e=="function"?Ls:Is)(e)):this.node().textContent}function Rs(){this.innerHTML=""}function Os(e){return function(){this.innerHTML=e}}function Hs(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function Vs(e){return arguments.length?this.each(e==null?Rs:(typeof e=="function"?Hs:Os)(e)):this.node().innerHTML}function Ys(){this.nextSibling&&this.parentNode.appendChild(this)}function Xs(){return this.each(Ys)}function Fs(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Bs(){return this.each(Fs)}function Us(e){var t=typeof e=="function"?e:ei(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function qs(){return null}function Gs(e,t){var n=typeof e=="function"?e:ei(e),i=t==null?qs:typeof t=="function"?t:Ge(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})}function Ks(){var e=this.parentNode;e&&e.removeChild(this)}function Ws(){return this.each(Ks)}function Zs(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Js(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Qs(e){return this.select(e?Js:Zs)}function js(e){return arguments.length?this.property("__data__",e):this.node().__data__}function to(e){return function(t){e.call(this,t,this.__data__)}}function eo(e){return e.trim().split(/^|\s+/).map(function(t){var n="",i=t.indexOf(".");return i>=0&&(n=t.slice(i+1),t=t.slice(0,i)),{type:t,name:n}})}function no(e){return function(){var t=this.__on;if(t){for(var n=0,i=-1,r=t.length,s;n<r;++n)s=t[n],(!e.type||s.type===e.type)&&s.name===e.name?this.removeEventListener(s.type,s.listener,s.options):t[++i]=s;++i?t.length=i:delete this.__on}}}function io(e,t,n){return function(){var i=this.__on,r,s=to(t);if(i){for(var o=0,a=i.length;o<a;++o)if((r=i[o]).type===e.type&&r.name===e.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=n),r.value=t;return}}this.addEventListener(e.type,s,n),r={type:e.type,name:e.name,value:t,listener:s,options:n},i?i.push(r):this.__on=[r]}}function ro(e,t,n){var i=eo(e+""),r,s=i.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,h=a.length,c;l<h;++l)for(r=0,c=a[l];r<s;++r)if((o=i[r]).type===c.type&&o.name===c.name)return c.value}return}for(a=t?io:no,r=0;r<s;++r)this.each(a(i[r],t,n));return this}function ui(e,t,n){var i=oi(e),r=i.CustomEvent;typeof r=="function"?r=new r(t,n):(r=i.document.createEvent("Event"),n?(r.initEvent(t,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(t,!1,!1)),e.dispatchEvent(r)}function so(e,t){return function(){return ui(this,e,t)}}function oo(e,t){return function(){return ui(this,e,t.apply(this,arguments))}}function ao(e,t){return this.each((typeof t=="function"?oo:so)(e,t))}function*lo(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i=e[t],r=0,s=i.length,o;r<s;++r)(o=i[r])&&(yield o)}var fi=[null];function V(e,t){this._groups=e,this._parents=t}function Wt(){return new V([[document.documentElement]],fi)}function ho(){return this}V.prototype=Wt.prototype={constructor:V,select:Lr,selectAll:Hr,selectChild:Fr,selectChildren:Gr,filter:Kr,data:ts,enter:Wr,exit:ns,join:is,merge:rs,selection:ho,order:ss,sort:os,call:ls,nodes:hs,node:cs,size:us,empty:fs,each:ds,attr:ws,style:As,property:Cs,classed:zs,text:Ds,html:Vs,raise:Xs,lower:Bs,append:Us,insert:Gs,remove:Ws,clone:Qs,datum:js,on:ro,dispatch:ao,[Symbol.iterator]:lo};function $n(e){return typeof e=="string"?new V([[document.querySelector(e)]],[document.documentElement]):new V([[e]],fi)}function We(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function di(e,t){var n=Object.create(e.prototype);for(var i in t)n[i]=t[i];return n}function Zt(){}var Ft=.7,fe=1/Ft,xt="\\s*([+-]?\\d+)\\s*",Bt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Z="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",co=/^#([0-9a-f]{3,8})$/,uo=new RegExp(`^rgb\\(${xt},${xt},${xt}\\)$`),fo=new RegExp(`^rgb\\(${Z},${Z},${Z}\\)$`),po=new RegExp(`^rgba\\(${xt},${xt},${xt},${Bt}\\)$`),_o=new RegExp(`^rgba\\(${Z},${Z},${Z},${Bt}\\)$`),go=new RegExp(`^hsl\\(${Bt},${Z},${Z}\\)$`),vo=new RegExp(`^hsla\\(${Bt},${Z},${Z},${Bt}\\)$`),An={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};We(Zt,Ut,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:Sn,formatHex:Sn,formatHex8:yo,formatHsl:mo,formatRgb:Nn,toString:Nn});function Sn(){return this.rgb().formatHex()}function yo(){return this.rgb().formatHex8()}function mo(){return pi(this).formatHsl()}function Nn(){return this.rgb().formatRgb()}function Ut(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=co.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?Mn(t):n===3?new R(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?re(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?re(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=uo.exec(e))?new R(t[1],t[2],t[3],1):(t=fo.exec(e))?new R(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=po.exec(e))?re(t[1],t[2],t[3],t[4]):(t=_o.exec(e))?re(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=go.exec(e))?En(t[1],t[2]/100,t[3]/100,1):(t=vo.exec(e))?En(t[1],t[2]/100,t[3]/100,t[4]):An.hasOwnProperty(e)?Mn(An[e]):e==="transparent"?new R(NaN,NaN,NaN,0):null}function Mn(e){return new R(e>>16&255,e>>8&255,e&255,1)}function re(e,t,n,i){return i<=0&&(e=t=n=NaN),new R(e,t,n,i)}function wo(e){return e instanceof Zt||(e=Ut(e)),e?(e=e.rgb(),new R(e.r,e.g,e.b,e.opacity)):new R}function De(e,t,n,i){return arguments.length===1?wo(e):new R(e,t,n,i??1)}function R(e,t,n,i){this.r=+e,this.g=+t,this.b=+n,this.opacity=+i}We(R,De,di(Zt,{brighter(e){return e=e==null?fe:Math.pow(fe,e),new R(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?Ft:Math.pow(Ft,e),new R(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new R(dt(this.r),dt(this.g),dt(this.b),de(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Cn,formatHex:Cn,formatHex8:xo,formatRgb:Tn,toString:Tn}));function Cn(){return`#${ft(this.r)}${ft(this.g)}${ft(this.b)}`}function xo(){return`#${ft(this.r)}${ft(this.g)}${ft(this.b)}${ft((isNaN(this.opacity)?1:this.opacity)*255)}`}function Tn(){const e=de(this.opacity);return`${e===1?"rgb(":"rgba("}${dt(this.r)}, ${dt(this.g)}, ${dt(this.b)}${e===1?")":`, ${e})`}`}function de(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function dt(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function ft(e){return e=dt(e),(e<16?"0":"")+e.toString(16)}function En(e,t,n,i){return i<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new G(e,t,n,i)}function pi(e){if(e instanceof G)return new G(e.h,e.s,e.l,e.opacity);if(e instanceof Zt||(e=Ut(e)),!e)return new G;if(e instanceof G)return e;e=e.rgb();var t=e.r/255,n=e.g/255,i=e.b/255,r=Math.min(t,n,i),s=Math.max(t,n,i),o=NaN,a=s-r,l=(s+r)/2;return a?(t===s?o=(n-i)/a+(n<i)*6:n===s?o=(i-t)/a+2:o=(t-n)/a+4,a/=l<.5?s+r:2-s-r,o*=60):a=l>0&&l<1?0:o,new G(o,a,l,e.opacity)}function bo(e,t,n,i){return arguments.length===1?pi(e):new G(e,t,n,i??1)}function G(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}We(G,bo,di(Zt,{brighter(e){return e=e==null?fe:Math.pow(fe,e),new G(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Ft:Math.pow(Ft,e),new G(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*t,r=2*n-i;return new R(Me(e>=240?e-240:e+120,r,i),Me(e,r,i),Me(e<120?e+240:e-120,r,i),this.opacity)},clamp(){return new G(kn(this.h),se(this.s),se(this.l),de(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=de(this.opacity);return`${e===1?"hsl(":"hsla("}${kn(this.h)}, ${se(this.s)*100}%, ${se(this.l)*100}%${e===1?")":`, ${e})`}`}}));function kn(e){return e=(e||0)%360,e<0?e+360:e}function se(e){return Math.max(0,Math.min(1,e||0))}function Me(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const _i=e=>()=>e;function $o(e,t){return function(n){return e+n*t}}function Ao(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(i){return Math.pow(e+i*t,n)}}function So(e){return(e=+e)==1?gi:function(t,n){return n-t?Ao(t,n,e):_i(isNaN(t)?n:t)}}function gi(e,t){var n=t-e;return n?$o(e,n):_i(isNaN(e)?t:e)}const zn=function e(t){var n=So(t);function i(r,s){var o=n((r=De(r)).r,(s=De(s)).r),a=n(r.g,s.g),l=n(r.b,s.b),h=gi(r.opacity,s.opacity);return function(c){return r.r=o(c),r.g=a(c),r.b=l(c),r.opacity=h(c),r+""}}return i.gamma=e,i}(1);function rt(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var Re=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Ce=new RegExp(Re.source,"g");function No(e){return function(){return e}}function Mo(e){return function(t){return e(t)+""}}function Co(e,t){var n=Re.lastIndex=Ce.lastIndex=0,i,r,s,o=-1,a=[],l=[];for(e=e+"",t=t+"";(i=Re.exec(e))&&(r=Ce.exec(t));)(s=r.index)>n&&(s=t.slice(n,s),a[o]?a[o]+=s:a[++o]=s),(i=i[0])===(r=r[0])?a[o]?a[o]+=r:a[++o]=r:(a[++o]=null,l.push({i:o,x:rt(i,r)})),n=Ce.lastIndex;return n<t.length&&(s=t.slice(n),a[o]?a[o]+=s:a[++o]=s),a.length<2?l[0]?Mo(l[0].x):No(t):(t=l.length,function(h){for(var c=0,f;c<t;++c)a[(f=l[c]).i]=f.x(h);return a.join("")})}var Pn=180/Math.PI,Oe={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function vi(e,t,n,i,r,s){var o,a,l;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(l=e*n+t*i)&&(n-=e*l,i-=t*l),(a=Math.sqrt(n*n+i*i))&&(n/=a,i/=a,l/=a),e*i<t*n&&(e=-e,t=-t,l=-l,o=-o),{translateX:r,translateY:s,rotate:Math.atan2(t,e)*Pn,skewX:Math.atan(l)*Pn,scaleX:o,scaleY:a}}var oe;function To(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?Oe:vi(t.a,t.b,t.c,t.d,t.e,t.f)}function Eo(e){return e==null||(oe||(oe=document.createElementNS("http://www.w3.org/2000/svg","g")),oe.setAttribute("transform",e),!(e=oe.transform.baseVal.consolidate()))?Oe:(e=e.matrix,vi(e.a,e.b,e.c,e.d,e.e,e.f))}function yi(e,t,n,i){function r(h){return h.length?h.pop()+" ":""}function s(h,c,f,d,u,g){if(h!==f||c!==d){var p=u.push("translate(",null,t,null,n);g.push({i:p-4,x:rt(h,f)},{i:p-2,x:rt(c,d)})}else(f||d)&&u.push("translate("+f+t+d+n)}function o(h,c,f,d){h!==c?(h-c>180?c+=360:c-h>180&&(h+=360),d.push({i:f.push(r(f)+"rotate(",null,i)-2,x:rt(h,c)})):c&&f.push(r(f)+"rotate("+c+i)}function a(h,c,f,d){h!==c?d.push({i:f.push(r(f)+"skewX(",null,i)-2,x:rt(h,c)}):c&&f.push(r(f)+"skewX("+c+i)}function l(h,c,f,d,u,g){if(h!==f||c!==d){var p=u.push(r(u)+"scale(",null,",",null,")");g.push({i:p-4,x:rt(h,f)},{i:p-2,x:rt(c,d)})}else(f!==1||d!==1)&&u.push(r(u)+"scale("+f+","+d+")")}return function(h,c){var f=[],d=[];return h=e(h),c=e(c),s(h.translateX,h.translateY,c.translateX,c.translateY,f,d),o(h.rotate,c.rotate,f,d),a(h.skewX,c.skewX,f,d),l(h.scaleX,h.scaleY,c.scaleX,c.scaleY,f,d),h=c=null,function(u){for(var g=-1,p=d.length,_;++g<p;)f[(_=d[g]).i]=_.x(u);return f.join("")}}}var ko=yi(To,"px, ","px)","deg)"),zo=yi(Eo,", ",")",")"),Nt=0,It=0,zt=0,mi=1e3,pe,Lt,_e=0,_t=0,xe=0,qt=typeof performance=="object"&&performance.now?performance:Date,wi=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Ze(){return _t||(wi(Po),_t=qt.now()+xe)}function Po(){_t=0}function ge(){this._call=this._time=this._next=null}ge.prototype=Je.prototype={constructor:ge,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?Ze():+n)+(t==null?0:+t),!this._next&&Lt!==this&&(Lt?Lt._next=this:pe=this,Lt=this),this._call=e,this._time=n,He()},stop:function(){this._call&&(this._call=null,this._time=1/0,He())}};function Je(e,t,n){var i=new ge;return i.restart(e,t,n),i}function Io(){Ze(),++Nt;for(var e=pe,t;e;)(t=_t-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Nt}function In(){_t=(_e=qt.now())+xe,Nt=It=0;try{Io()}finally{Nt=0,Do(),_t=0}}function Lo(){var e=qt.now(),t=e-_e;t>mi&&(xe-=t,_e=e)}function Do(){for(var e,t=pe,n,i=1/0;t;)t._call?(i>t._time&&(i=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:pe=n);Lt=e,He(i)}function He(e){if(!Nt){It&&(It=clearTimeout(It));var t=e-_t;t>24?(e<1/0&&(It=setTimeout(In,e-qt.now()-xe)),zt&&(zt=clearInterval(zt))):(zt||(_e=qt.now(),zt=setInterval(Lo,mi)),Nt=1,wi(In))}}function Ln(e,t,n){var i=new ge;return t=t==null?0:+t,i.restart(r=>{i.stop(),e(r+t)},t,n),i}var Ro=qe("start","end","cancel","interrupt"),Oo=[],xi=0,Dn=1,Ve=2,le=3,Rn=4,Ye=5,he=6;function be(e,t,n,i,r,s){var o=e.__transition;if(!o)e.__transition={};else if(n in o)return;Ho(e,n,{name:t,index:i,group:r,on:Ro,tween:Oo,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:xi})}function Qe(e,t){var n=K(e,t);if(n.state>xi)throw new Error("too late; already scheduled");return n}function Q(e,t){var n=K(e,t);if(n.state>le)throw new Error("too late; already running");return n}function K(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function Ho(e,t,n){var i=e.__transition,r;i[t]=n,n.timer=Je(s,0,n.time);function s(h){n.state=Dn,n.timer.restart(o,n.delay,n.time),n.delay<=h&&o(h-n.delay)}function o(h){var c,f,d,u;if(n.state!==Dn)return l();for(c in i)if(u=i[c],u.name===n.name){if(u.state===le)return Ln(o);u.state===Rn?(u.state=he,u.timer.stop(),u.on.call("interrupt",e,e.__data__,u.index,u.group),delete i[c]):+c<t&&(u.state=he,u.timer.stop(),u.on.call("cancel",e,e.__data__,u.index,u.group),delete i[c])}if(Ln(function(){n.state===le&&(n.state=Rn,n.timer.restart(a,n.delay,n.time),a(h))}),n.state=Ve,n.on.call("start",e,e.__data__,n.index,n.group),n.state===Ve){for(n.state=le,r=new Array(d=n.tween.length),c=0,f=-1;c<d;++c)(u=n.tween[c].value.call(e,e.__data__,n.index,n.group))&&(r[++f]=u);r.length=f+1}}function a(h){for(var c=h<n.duration?n.ease.call(null,h/n.duration):(n.timer.restart(l),n.state=Ye,1),f=-1,d=r.length;++f<d;)r[f].call(e,c);n.state===Ye&&(n.on.call("end",e,e.__data__,n.index,n.group),l())}function l(){n.state=he,n.timer.stop(),delete i[t];for(var h in i)return;delete e.__transition}}function Vo(e,t){var n=e.__transition,i,r,s=!0,o;if(n){t=t==null?null:t+"";for(o in n){if((i=n[o]).name!==t){s=!1;continue}r=i.state>Ve&&i.state<Ye,i.state=he,i.timer.stop(),i.on.call(r?"interrupt":"cancel",e,e.__data__,i.index,i.group),delete n[o]}s&&delete e.__transition}}function Yo(e){return this.each(function(){Vo(this,e)})}function Xo(e,t){var n,i;return function(){var r=Q(this,e),s=r.tween;if(s!==n){i=n=s;for(var o=0,a=i.length;o<a;++o)if(i[o].name===t){i=i.slice(),i.splice(o,1);break}}r.tween=i}}function Fo(e,t,n){var i,r;if(typeof n!="function")throw new Error;return function(){var s=Q(this,e),o=s.tween;if(o!==i){r=(i=o).slice();for(var a={name:t,value:n},l=0,h=r.length;l<h;++l)if(r[l].name===t){r[l]=a;break}l===h&&r.push(a)}s.tween=r}}function Bo(e,t){var n=this._id;if(e+="",arguments.length<2){for(var i=K(this.node(),n).tween,r=0,s=i.length,o;r<s;++r)if((o=i[r]).name===e)return o.value;return null}return this.each((t==null?Xo:Fo)(n,e,t))}function je(e,t,n){var i=e._id;return e.each(function(){var r=Q(this,i);(r.value||(r.value={}))[t]=n.apply(this,arguments)}),function(r){return K(r,i).value[t]}}function bi(e,t){var n;return(typeof t=="number"?rt:t instanceof Ut?zn:(n=Ut(t))?(t=n,zn):Co)(e,t)}function Uo(e){return function(){this.removeAttribute(e)}}function qo(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Go(e,t,n){var i,r=n+"",s;return function(){var o=this.getAttribute(e);return o===r?null:o===i?s:s=t(i=o,n)}}function Ko(e,t,n){var i,r=n+"",s;return function(){var o=this.getAttributeNS(e.space,e.local);return o===r?null:o===i?s:s=t(i=o,n)}}function Wo(e,t,n){var i,r,s;return function(){var o,a=n(this),l;return a==null?void this.removeAttribute(e):(o=this.getAttribute(e),l=a+"",o===l?null:o===i&&l===r?s:(r=l,s=t(i=o,a)))}}function Zo(e,t,n){var i,r,s;return function(){var o,a=n(this),l;return a==null?void this.removeAttributeNS(e.space,e.local):(o=this.getAttributeNS(e.space,e.local),l=a+"",o===l?null:o===i&&l===r?s:(r=l,s=t(i=o,a)))}}function Jo(e,t){var n=we(e),i=n==="transform"?zo:bi;return this.attrTween(e,typeof t=="function"?(n.local?Zo:Wo)(n,i,je(this,"attr."+e,t)):t==null?(n.local?qo:Uo)(n):(n.local?Ko:Go)(n,i,t))}function Qo(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function jo(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function ta(e,t){var n,i;function r(){var s=t.apply(this,arguments);return s!==i&&(n=(i=s)&&jo(e,s)),n}return r._value=t,r}function ea(e,t){var n,i;function r(){var s=t.apply(this,arguments);return s!==i&&(n=(i=s)&&Qo(e,s)),n}return r._value=t,r}function na(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var i=we(e);return this.tween(n,(i.local?ta:ea)(i,t))}function ia(e,t){return function(){Qe(this,e).delay=+t.apply(this,arguments)}}function ra(e,t){return t=+t,function(){Qe(this,e).delay=t}}function sa(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?ia:ra)(t,e)):K(this.node(),t).delay}function oa(e,t){return function(){Q(this,e).duration=+t.apply(this,arguments)}}function aa(e,t){return t=+t,function(){Q(this,e).duration=t}}function la(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?oa:aa)(t,e)):K(this.node(),t).duration}function ha(e,t){if(typeof t!="function")throw new Error;return function(){Q(this,e).ease=t}}function ca(e){var t=this._id;return arguments.length?this.each(ha(t,e)):K(this.node(),t).ease}function ua(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;Q(this,e).ease=n}}function fa(e){if(typeof e!="function")throw new Error;return this.each(ua(this._id,e))}function da(e){typeof e!="function"&&(e=ii(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var s=t[r],o=s.length,a=i[r]=[],l,h=0;h<o;++h)(l=s[h])&&e.call(l,l.__data__,h,s)&&a.push(l);return new et(i,this._parents,this._name,this._id)}function pa(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,i=t.length,r=n.length,s=Math.min(i,r),o=new Array(i),a=0;a<s;++a)for(var l=t[a],h=n[a],c=l.length,f=o[a]=new Array(c),d,u=0;u<c;++u)(d=l[u]||h[u])&&(f[u]=d);for(;a<i;++a)o[a]=t[a];return new et(o,this._parents,this._name,this._id)}function _a(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function ga(e,t,n){var i,r,s=_a(t)?Qe:Q;return function(){var o=s(this,e),a=o.on;a!==i&&(r=(i=a).copy()).on(t,n),o.on=r}}function va(e,t){var n=this._id;return arguments.length<2?K(this.node(),n).on.on(e):this.each(ga(n,e,t))}function ya(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function ma(){return this.on("end.remove",ya(this._id))}function wa(e){var t=this._name,n=this._id;typeof e!="function"&&(e=Ge(e));for(var i=this._groups,r=i.length,s=new Array(r),o=0;o<r;++o)for(var a=i[o],l=a.length,h=s[o]=new Array(l),c,f,d=0;d<l;++d)(c=a[d])&&(f=e.call(c,c.__data__,d,a))&&("__data__"in c&&(f.__data__=c.__data__),h[d]=f,be(h[d],t,n,d,h,K(c,n)));return new et(s,this._parents,t,n)}function xa(e){var t=this._name,n=this._id;typeof e!="function"&&(e=ni(e));for(var i=this._groups,r=i.length,s=[],o=[],a=0;a<r;++a)for(var l=i[a],h=l.length,c,f=0;f<h;++f)if(c=l[f]){for(var d=e.call(c,c.__data__,f,l),u,g=K(c,n),p=0,_=d.length;p<_;++p)(u=d[p])&&be(u,t,n,p,d,g);s.push(d),o.push(c)}return new et(s,o,t,n)}var ba=Wt.prototype.constructor;function $a(){return new ba(this._groups,this._parents)}function Aa(e,t){var n,i,r;return function(){var s=St(this,e),o=(this.style.removeProperty(e),St(this,e));return s===o?null:s===n&&o===i?r:r=t(n=s,i=o)}}function $i(e){return function(){this.style.removeProperty(e)}}function Sa(e,t,n){var i,r=n+"",s;return function(){var o=St(this,e);return o===r?null:o===i?s:s=t(i=o,n)}}function Na(e,t,n){var i,r,s;return function(){var o=St(this,e),a=n(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(e),St(this,e))),o===l?null:o===i&&l===r?s:(r=l,s=t(i=o,a))}}function Ma(e,t){var n,i,r,s="style."+t,o="end."+s,a;return function(){var l=Q(this,e),h=l.on,c=l.value[s]==null?a||(a=$i(t)):void 0;(h!==n||r!==c)&&(i=(n=h).copy()).on(o,r=c),l.on=i}}function Ca(e,t,n){var i=(e+="")=="transform"?ko:bi;return t==null?this.styleTween(e,Aa(e,i)).on("end.style."+e,$i(e)):typeof t=="function"?this.styleTween(e,Na(e,i,je(this,"style."+e,t))).each(Ma(this._id,e)):this.styleTween(e,Sa(e,i,t),n).on("end.style."+e,null)}function Ta(e,t,n){return function(i){this.style.setProperty(e,t.call(this,i),n)}}function Ea(e,t,n){var i,r;function s(){var o=t.apply(this,arguments);return o!==r&&(i=(r=o)&&Ta(e,o,n)),i}return s._value=t,s}function ka(e,t,n){var i="style."+(e+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(t==null)return this.tween(i,null);if(typeof t!="function")throw new Error;return this.tween(i,Ea(e,t,n??""))}function za(e){return function(){this.textContent=e}}function Pa(e){return function(){var t=e(this);this.textContent=t??""}}function Ia(e){return this.tween("text",typeof e=="function"?Pa(je(this,"text",e)):za(e==null?"":e+""))}function La(e){return function(t){this.textContent=e.call(this,t)}}function Da(e){var t,n;function i(){var r=e.apply(this,arguments);return r!==n&&(t=(n=r)&&La(r)),t}return i._value=e,i}function Ra(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,Da(e))}function Oa(){for(var e=this._name,t=this._id,n=Ai(),i=this._groups,r=i.length,s=0;s<r;++s)for(var o=i[s],a=o.length,l,h=0;h<a;++h)if(l=o[h]){var c=K(l,t);be(l,e,n,h,o,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new et(i,this._parents,e,n)}function Ha(){var e,t,n=this,i=n._id,r=n.size();return new Promise(function(s,o){var a={value:o},l={value:function(){--r===0&&s()}};n.each(function(){var h=Q(this,i),c=h.on;c!==e&&(t=(e=c).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(l)),h.on=t}),r===0&&s()})}var Va=0;function et(e,t,n,i){this._groups=e,this._parents=t,this._name=n,this._id=i}function Ai(){return++Va}var tt=Wt.prototype;et.prototype={constructor:et,select:wa,selectAll:xa,selectChild:tt.selectChild,selectChildren:tt.selectChildren,filter:da,merge:pa,selection:$a,transition:Oa,call:tt.call,nodes:tt.nodes,node:tt.node,size:tt.size,empty:tt.empty,each:tt.each,on:va,attr:Jo,attrTween:na,style:Ca,styleTween:ka,text:Ia,textTween:Ra,remove:ma,tween:Bo,delay:sa,duration:la,ease:ca,easeVarying:fa,end:Ha,[Symbol.iterator]:tt[Symbol.iterator]};function Ya(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var Xa={time:null,delay:0,duration:250,ease:Ya};function Fa(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function Ba(e){var t,n;e instanceof et?(t=e._id,e=e._name):(t=Ai(),(n=Xa).time=Ze(),e=e==null?null:e+"");for(var i=this._groups,r=i.length,s=0;s<r;++s)for(var o=i[s],a=o.length,l,h=0;h<a;++h)(l=o[h])&&be(l,e,t,h,o,n||Fa(l,t));return new et(i,this._parents,e,t)}Wt.prototype.interrupt=Yo;Wt.prototype.transition=Ba;const Xe=Math.PI,Fe=2*Xe,ct=1e-6,Ua=Fe-ct;function Si(e){this._+=e[0];for(let t=1,n=e.length;t<n;++t)this._+=arguments[t]+e[t]}function qa(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return Si;const n=10**t;return function(i){this._+=i[0];for(let r=1,s=i.length;r<s;++r)this._+=Math.round(arguments[r]*n)/n+i[r]}}class Ga{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?Si:qa(t)}moveTo(t,n){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,n){this._append`L${this._x1=+t},${this._y1=+n}`}quadraticCurveTo(t,n,i,r){this._append`Q${+t},${+n},${this._x1=+i},${this._y1=+r}`}bezierCurveTo(t,n,i,r,s,o){this._append`C${+t},${+n},${+i},${+r},${this._x1=+s},${this._y1=+o}`}arcTo(t,n,i,r,s){if(t=+t,n=+n,i=+i,r=+r,s=+s,s<0)throw new Error(`negative radius: ${s}`);let o=this._x1,a=this._y1,l=i-t,h=r-n,c=o-t,f=a-n,d=c*c+f*f;if(this._x1===null)this._append`M${this._x1=t},${this._y1=n}`;else if(d>ct)if(!(Math.abs(f*l-h*c)>ct)||!s)this._append`L${this._x1=t},${this._y1=n}`;else{let u=i-o,g=r-a,p=l*l+h*h,_=u*u+g*g,y=Math.sqrt(p),x=Math.sqrt(d),S=s*Math.tan((Xe-Math.acos((p+d-_)/(2*y*x)))/2),w=S/x,N=S/y;Math.abs(w-1)>ct&&this._append`L${t+w*c},${n+w*f}`,this._append`A${s},${s},0,0,${+(f*u>c*g)},${this._x1=t+N*l},${this._y1=n+N*h}`}}arc(t,n,i,r,s,o){if(t=+t,n=+n,i=+i,o=!!o,i<0)throw new Error(`negative radius: ${i}`);let a=i*Math.cos(r),l=i*Math.sin(r),h=t+a,c=n+l,f=1^o,d=o?r-s:s-r;this._x1===null?this._append`M${h},${c}`:(Math.abs(this._x1-h)>ct||Math.abs(this._y1-c)>ct)&&this._append`L${h},${c}`,i&&(d<0&&(d=d%Fe+Fe),d>Ua?this._append`A${i},${i},0,1,${f},${t-a},${n-l}A${i},${i},0,1,${f},${this._x1=h},${this._y1=c}`:d>ct&&this._append`A${i},${i},0,${+(d>=Xe)},${f},${this._x1=t+i*Math.cos(s)},${this._y1=n+i*Math.sin(s)}`)}rect(t,n,i,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${i=+i}v${+r}h${-i}Z`}toString(){return this._}}function Ka(e){const t=+this._x.call(null,e),n=+this._y.call(null,e);return Ni(this.cover(t,n),t,n,e)}function Ni(e,t,n,i){if(isNaN(t)||isNaN(n))return e;var r,s=e._root,o={data:i},a=e._x0,l=e._y0,h=e._x1,c=e._y1,f,d,u,g,p,_,y,x;if(!s)return e._root=o,e;for(;s.length;)if((p=t>=(f=(a+h)/2))?a=f:h=f,(_=n>=(d=(l+c)/2))?l=d:c=d,r=s,!(s=s[y=_<<1|p]))return r[y]=o,e;if(u=+e._x.call(null,s.data),g=+e._y.call(null,s.data),t===u&&n===g)return o.next=s,r?r[y]=o:e._root=o,e;do r=r?r[y]=new Array(4):e._root=new Array(4),(p=t>=(f=(a+h)/2))?a=f:h=f,(_=n>=(d=(l+c)/2))?l=d:c=d;while((y=_<<1|p)===(x=(g>=d)<<1|u>=f));return r[x]=s,r[y]=o,e}function Wa(e){var t,n,i=e.length,r,s,o=new Array(i),a=new Array(i),l=1/0,h=1/0,c=-1/0,f=-1/0;for(n=0;n<i;++n)isNaN(r=+this._x.call(null,t=e[n]))||isNaN(s=+this._y.call(null,t))||(o[n]=r,a[n]=s,r<l&&(l=r),r>c&&(c=r),s<h&&(h=s),s>f&&(f=s));if(l>c||h>f)return this;for(this.cover(l,h).cover(c,f),n=0;n<i;++n)Ni(this,o[n],a[n],e[n]);return this}function Za(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,i=this._y0,r=this._x1,s=this._y1;if(isNaN(n))r=(n=Math.floor(e))+1,s=(i=Math.floor(t))+1;else{for(var o=r-n||1,a=this._root,l,h;n>e||e>=r||i>t||t>=s;)switch(h=(t<i)<<1|e<n,l=new Array(4),l[h]=a,a=l,o*=2,h){case 0:r=n+o,s=i+o;break;case 1:n=r-o,s=i+o;break;case 2:r=n+o,i=s-o;break;case 3:n=r-o,i=s-o;break}this._root&&this._root.length&&(this._root=a)}return this._x0=n,this._y0=i,this._x1=r,this._y1=s,this}function Ja(){var e=[];return this.visit(function(t){if(!t.length)do e.push(t.data);while(t=t.next)}),e}function Qa(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function L(e,t,n,i,r){this.node=e,this.x0=t,this.y0=n,this.x1=i,this.y1=r}function ja(e,t,n){var i,r=this._x0,s=this._y0,o,a,l,h,c=this._x1,f=this._y1,d=[],u=this._root,g,p;for(u&&d.push(new L(u,r,s,c,f)),n==null?n=1/0:(r=e-n,s=t-n,c=e+n,f=t+n,n*=n);g=d.pop();)if(!(!(u=g.node)||(o=g.x0)>c||(a=g.y0)>f||(l=g.x1)<r||(h=g.y1)<s))if(u.length){var _=(o+l)/2,y=(a+h)/2;d.push(new L(u[3],_,y,l,h),new L(u[2],o,y,_,h),new L(u[1],_,a,l,y),new L(u[0],o,a,_,y)),(p=(t>=y)<<1|e>=_)&&(g=d[d.length-1],d[d.length-1]=d[d.length-1-p],d[d.length-1-p]=g)}else{var x=e-+this._x.call(null,u.data),S=t-+this._y.call(null,u.data),w=x*x+S*S;if(w<n){var N=Math.sqrt(n=w);r=e-N,s=t-N,c=e+N,f=t+N,i=u.data}}return i}function tl(e){if(isNaN(c=+this._x.call(null,e))||isNaN(f=+this._y.call(null,e)))return this;var t,n=this._root,i,r,s,o=this._x0,a=this._y0,l=this._x1,h=this._y1,c,f,d,u,g,p,_,y;if(!n)return this;if(n.length)for(;;){if((g=c>=(d=(o+l)/2))?o=d:l=d,(p=f>=(u=(a+h)/2))?a=u:h=u,t=n,!(n=n[_=p<<1|g]))return this;if(!n.length)break;(t[_+1&3]||t[_+2&3]||t[_+3&3])&&(i=t,y=_)}for(;n.data!==e;)if(r=n,!(n=n.next))return this;return(s=n.next)&&delete n.next,r?(s?r.next=s:delete r.next,this):t?(s?t[_]=s:delete t[_],(n=t[0]||t[1]||t[2]||t[3])&&n===(t[3]||t[2]||t[1]||t[0])&&!n.length&&(i?i[y]=n:this._root=n),this):(this._root=s,this)}function el(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this}function nl(){return this._root}function il(){var e=0;return this.visit(function(t){if(!t.length)do++e;while(t=t.next)}),e}function rl(e){var t=[],n,i=this._root,r,s,o,a,l;for(i&&t.push(new L(i,this._x0,this._y0,this._x1,this._y1));n=t.pop();)if(!e(i=n.node,s=n.x0,o=n.y0,a=n.x1,l=n.y1)&&i.length){var h=(s+a)/2,c=(o+l)/2;(r=i[3])&&t.push(new L(r,h,c,a,l)),(r=i[2])&&t.push(new L(r,s,c,h,l)),(r=i[1])&&t.push(new L(r,h,o,a,c)),(r=i[0])&&t.push(new L(r,s,o,h,c))}return this}function sl(e){var t=[],n=[],i;for(this._root&&t.push(new L(this._root,this._x0,this._y0,this._x1,this._y1));i=t.pop();){var r=i.node;if(r.length){var s,o=i.x0,a=i.y0,l=i.x1,h=i.y1,c=(o+l)/2,f=(a+h)/2;(s=r[0])&&t.push(new L(s,o,a,c,f)),(s=r[1])&&t.push(new L(s,c,a,l,f)),(s=r[2])&&t.push(new L(s,o,f,c,h)),(s=r[3])&&t.push(new L(s,c,f,l,h))}n.push(i)}for(;i=n.pop();)e(i.node,i.x0,i.y0,i.x1,i.y1);return this}function ol(e){return e[0]}function al(e){return arguments.length?(this._x=e,this):this._x}function ll(e){return e[1]}function hl(e){return arguments.length?(this._y=e,this):this._y}function Mi(e,t,n){var i=new tn(t??ol,n??ll,NaN,NaN,NaN,NaN);return e==null?i:i.addAll(e)}function tn(e,t,n,i,r,s){this._x=e,this._y=t,this._x0=n,this._y0=i,this._x1=r,this._y1=s,this._root=void 0}function On(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}var D=Mi.prototype=tn.prototype;D.copy=function(){var e=new tn(this._x,this._y,this._x0,this._y0,this._x1,this._y1),t=this._root,n,i;if(!t)return e;if(!t.length)return e._root=On(t),e;for(n=[{source:t,target:e._root=new Array(4)}];t=n.pop();)for(var r=0;r<4;++r)(i=t.source[r])&&(i.length?n.push({source:i,target:t.target[r]=new Array(4)}):t.target[r]=On(i));return e};D.add=Ka;D.addAll=Wa;D.cover=Za;D.data=Ja;D.extent=Qa;D.find=ja;D.remove=tl;D.removeAll=el;D.root=nl;D.size=il;D.visit=rl;D.visitAfter=sl;D.x=al;D.y=hl;function Rt(e){return function(){return e}}function wt(e){return(e()-.5)*1e-6}function cl(e){return e.index}function Hn(e,t){var n=e.get(t);if(!n)throw new Error("node not found: "+t);return n}function ul(e){var t=cl,n=f,i,r=Rt(30),s,o,a,l,h,c=1;e==null&&(e=[]);function f(_){return 1/Math.min(a[_.source.index],a[_.target.index])}function d(_){for(var y=0,x=e.length;y<c;++y)for(var S=0,w,N,E,k,$,M,O;S<x;++S)w=e[S],N=w.source,E=w.target,k=E.x+E.vx-N.x-N.vx||wt(h),$=E.y+E.vy-N.y-N.vy||wt(h),M=Math.sqrt(k*k+$*$),M=(M-s[S])/M*_*i[S],k*=M,$*=M,E.vx-=k*(O=l[S]),E.vy-=$*O,N.vx+=k*(O=1-O),N.vy+=$*O}function u(){if(o){var _,y=o.length,x=e.length,S=new Map(o.map((N,E)=>[t(N,E,o),N])),w;for(_=0,a=new Array(y);_<x;++_)w=e[_],w.index=_,typeof w.source!="object"&&(w.source=Hn(S,w.source)),typeof w.target!="object"&&(w.target=Hn(S,w.target)),a[w.source.index]=(a[w.source.index]||0)+1,a[w.target.index]=(a[w.target.index]||0)+1;for(_=0,l=new Array(x);_<x;++_)w=e[_],l[_]=a[w.source.index]/(a[w.source.index]+a[w.target.index]);i=new Array(x),g(),s=new Array(x),p()}}function g(){if(o)for(var _=0,y=e.length;_<y;++_)i[_]=+n(e[_],_,e)}function p(){if(o)for(var _=0,y=e.length;_<y;++_)s[_]=+r(e[_],_,e)}return d.initialize=function(_,y){o=_,h=y,u()},d.links=function(_){return arguments.length?(e=_,u(),d):e},d.id=function(_){return arguments.length?(t=_,d):t},d.iterations=function(_){return arguments.length?(c=+_,d):c},d.strength=function(_){return arguments.length?(n=typeof _=="function"?_:Rt(+_),g(),d):n},d.distance=function(_){return arguments.length?(r=typeof _=="function"?_:Rt(+_),p(),d):r},d}const fl=1664525,dl=1013904223,Vn=4294967296;function pl(){let e=1;return()=>(e=(fl*e+dl)%Vn)/Vn}function _l(e){return e.x}function gl(e){return e.y}var vl=10,yl=Math.PI*(3-Math.sqrt(5));function ml(e){var t,n=1,i=.001,r=1-Math.pow(i,1/300),s=0,o=.6,a=new Map,l=Je(f),h=qe("tick","end"),c=pl();e==null&&(e=[]);function f(){d(),h.call("tick",t),n<i&&(l.stop(),h.call("end",t))}function d(p){var _,y=e.length,x;p===void 0&&(p=1);for(var S=0;S<p;++S)for(n+=(s-n)*r,a.forEach(function(w){w(n)}),_=0;_<y;++_)x=e[_],x.fx==null?x.x+=x.vx*=o:(x.x=x.fx,x.vx=0),x.fy==null?x.y+=x.vy*=o:(x.y=x.fy,x.vy=0);return t}function u(){for(var p=0,_=e.length,y;p<_;++p){if(y=e[p],y.index=p,y.fx!=null&&(y.x=y.fx),y.fy!=null&&(y.y=y.fy),isNaN(y.x)||isNaN(y.y)){var x=vl*Math.sqrt(.5+p),S=p*yl;y.x=x*Math.cos(S),y.y=x*Math.sin(S)}(isNaN(y.vx)||isNaN(y.vy))&&(y.vx=y.vy=0)}}function g(p){return p.initialize&&p.initialize(e,c),p}return u(),t={tick:d,restart:function(){return l.restart(f),t},stop:function(){return l.stop(),t},nodes:function(p){return arguments.length?(e=p,u(),a.forEach(g),t):e},alpha:function(p){return arguments.length?(n=+p,t):n},alphaMin:function(p){return arguments.length?(i=+p,t):i},alphaDecay:function(p){return arguments.length?(r=+p,t):+r},alphaTarget:function(p){return arguments.length?(s=+p,t):s},velocityDecay:function(p){return arguments.length?(o=1-p,t):1-o},randomSource:function(p){return arguments.length?(c=p,a.forEach(g),t):c},force:function(p,_){return arguments.length>1?(_==null?a.delete(p):a.set(p,g(_)),t):a.get(p)},find:function(p,_,y){var x=0,S=e.length,w,N,E,k,$;for(y==null?y=1/0:y*=y,x=0;x<S;++x)k=e[x],w=p-k.x,N=_-k.y,E=w*w+N*N,E<y&&($=k,y=E);return $},on:function(p,_){return arguments.length>1?(h.on(p,_),t):h.on(p)}}}function wl(){var e,t,n,i,r=Rt(-30),s,o=1,a=1/0,l=.81;function h(u){var g,p=e.length,_=Mi(e,_l,gl).visitAfter(f);for(i=u,g=0;g<p;++g)t=e[g],_.visit(d)}function c(){if(e){var u,g=e.length,p;for(s=new Array(g),u=0;u<g;++u)p=e[u],s[p.index]=+r(p,u,e)}}function f(u){var g=0,p,_,y=0,x,S,w;if(u.length){for(x=S=w=0;w<4;++w)(p=u[w])&&(_=Math.abs(p.value))&&(g+=p.value,y+=_,x+=_*p.x,S+=_*p.y);u.x=x/y,u.y=S/y}else{p=u,p.x=p.data.x,p.y=p.data.y;do g+=s[p.data.index];while(p=p.next)}u.value=g}function d(u,g,p,_){if(!u.value)return!0;var y=u.x-t.x,x=u.y-t.y,S=_-g,w=y*y+x*x;if(S*S/l<w)return w<a&&(y===0&&(y=wt(n),w+=y*y),x===0&&(x=wt(n),w+=x*x),w<o&&(w=Math.sqrt(o*w)),t.vx+=y*u.value*i/w,t.vy+=x*u.value*i/w),!0;if(u.length||w>=a)return;(u.data!==t||u.next)&&(y===0&&(y=wt(n),w+=y*y),x===0&&(x=wt(n),w+=x*x),w<o&&(w=Math.sqrt(o*w)));do u.data!==t&&(S=s[u.data.index]*i/w,t.vx+=y*S,t.vy+=x*S);while(u=u.next)}return h.initialize=function(u,g){e=u,n=g,c()},h.strength=function(u){return arguments.length?(r=typeof u=="function"?u:Rt(+u),c(),h):r},h.distanceMin=function(u){return arguments.length?(o=u*u,h):Math.sqrt(o)},h.distanceMax=function(u){return arguments.length?(a=u*u,h):Math.sqrt(a)},h.theta=function(u){return arguments.length?(l=u*u,h):Math.sqrt(l)},h}function vt(e){return function(){return e}}const Yn=1e-12;function xl(e){let t=3;return e.digits=function(n){if(!arguments.length)return t;if(n==null)t=null;else{const i=Math.floor(n);if(!(i>=0))throw new RangeError(`invalid digits: ${n}`);t=i}return e},()=>new Ga(t)}function bl(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function Ci(e){this._context=e}Ci.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function $l(e){return new Ci(e)}function Al(e){return e[0]}function Sl(e){return e[1]}function Nl(e,t){var n=vt(!0),i=null,r=$l,s=null,o=xl(a);e=typeof e=="function"?e:e===void 0?Al:vt(e),t=typeof t=="function"?t:t===void 0?Sl:vt(t);function a(l){var h,c=(l=bl(l)).length,f,d=!1,u;for(i==null&&(s=r(u=o())),h=0;h<=c;++h)!(h<c&&n(f=l[h],h,l))===d&&((d=!d)?s.lineStart():s.lineEnd()),d&&s.point(+e(f,h,l),+t(f,h,l));if(u)return s=null,u+""||null}return a.x=function(l){return arguments.length?(e=typeof l=="function"?l:vt(+l),a):e},a.y=function(l){return arguments.length?(t=typeof l=="function"?l:vt(+l),a):t},a.defined=function(l){return arguments.length?(n=typeof l=="function"?l:vt(!!l),a):n},a.curve=function(l){return arguments.length?(r=l,i!=null&&(s=r(i)),a):r},a.context=function(l){return arguments.length?(l==null?i=s=null:s=r(i=l),a):i},a}function Be(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function en(e,t){this._context=e,this._k=(1-t)/6}en.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:Be(this,this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:Be(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};(function e(t){function n(i){return new en(i,t)}return n.tension=function(i){return e(+i)},n})(0);function nn(e,t){this._context=e,this._k=(1-t)/6}nn.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Be(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};(function e(t){function n(i){return new nn(i,t)}return n.tension=function(i){return e(+i)},n})(0);function Ti(e,t,n){var i=e._x1,r=e._y1,s=e._x2,o=e._y2;if(e._l01_a>Yn){var a=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,l=3*e._l01_a*(e._l01_a+e._l12_a);i=(i*a-e._x0*e._l12_2a+e._x2*e._l01_2a)/l,r=(r*a-e._y0*e._l12_2a+e._y2*e._l01_2a)/l}if(e._l23_a>Yn){var h=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,c=3*e._l23_a*(e._l23_a+e._l12_a);s=(s*h+e._x1*e._l23_2a-t*e._l12_2a)/c,o=(o*h+e._y1*e._l23_2a-n*e._l12_2a)/c}e._context.bezierCurveTo(i,r,s,o,e._x2,e._y2)}function Ei(e,t){this._context=e,this._alpha=t}Ei.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,i=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:Ti(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};(function e(t){function n(i){return t?new Ei(i,t):new en(i,0)}return n.alpha=function(i){return e(+i)},n})(.5);function ki(e,t){this._context=e,this._alpha=t}ki.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,i=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Ti(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const Ml=function e(t){function n(i){return t?new ki(i,t):new nn(i,0)}return n.alpha=function(i){return e(+i)},n}(.5);function Dt(e,t,n){this.k=e,this.x=t,this.y=n}Dt.prototype={constructor:Dt,scale:function(e){return e===1?this:new Dt(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new Dt(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};Dt.prototype;function Cl(e,t,n,i){const r=new $r(t),s=new wr(r),o=new Cr(s.cn),a=[n,i],l=$n(".simcontainer").append("svg").attr("width","100%").attr("height","100%");function h($){var M=$n(".simcontainer").node().getBoundingClientRect();const O=M.width,nt=M.height,W=e.vDist;return $.contactNodes.forEach((I,Jt)=>{const it=Jt%$.width,Ct=(Jt-it)/$.width;I.i=it,I.j=Ct,I.x=O/2-W*($.width-1)/2+it*W,I.y=nt/2+W*($.height-1)/2-Ct*W}),$.contactNodes}const c=h(o),f=o.makeNice(),d=o.yarnPathToLinks(),u=l.append("g").attr("class","yarns-behind"),g=l.append("g").attr("class","yarns"),p=u.attr("filter","brightness(0.7)").attr("stroke-width",e.yarnWidth).attr("stroke-linecap","round").selectAll().data(d).join("path").filter(function($){return!($.linkType=="FLFH"||$.linkType=="LHLL")}).attr("fill","none").attr("stroke",$=>a[$.row%4<2?0:1]),_=g.attr("stroke-width",e.yarnWidth).attr("stroke-linecap","round").selectAll().data(d).join("path").filter(function($){return $.linkType=="FLFH"||$.linkType=="LHLL"}).attr("fill","none").attr("stroke",$=>a[$.row%4<2?0:1]);function y($,M,O){if($.index===M.index)return[0,0];const nt=$.x-M.x,W=$.y-M.y,I=Math.sqrt(nt**2+W**2);return O?[-W/I,nt/I]:[W/I,-nt/I]}function x(){f[0].normal=y(c[f[0].cnIndex],c[f[1].cnIndex],!0);for(let $=1;$<f.length-1;$++)f[$].normal=y(c[f[$-1].cnIndex],c[f[$+1].cnIndex],f[$].j%2!=0);f.at(-1).normal=y(c[f.at(-2).cnIndex],c[f.at(-1).cnIndex],!0)}const S=Nl().x($=>c[$.cnIndex].x+e.yarnWidth/2*$.normal[0]).y($=>c[$.cnIndex].y+e.yarnWidth/2*$.normal[1]).curve(Ml);function w($){const M=$.index;if(M==0||M>d.length-3)return`M ${$.source.x} ${$.source.y} ${$.target.x} ${$.target.y}`;const O=[f[M-1],f[M],f[M+1],f[M+2]];return S(O)}function N(){x(),_.attr("d",w),p.attr("d",w)}const E=ml(c).force("charge",wl().strength(-40).distanceMax(40)).force("link",ul(d).strength(2).distance($=>$.linkType=="LLFL"||$.linkType=="FHLH"?e.hDist:e.vDist).iterations(2)).on("tick",N);function k(){E.stop(),_.on("mousedown.drag",null),p.on("mousedown.drag",null),l.remove()}return k}let Te;class Tl{constructor(t,n,i,r){this.parentEl=t,this.dispatch=r,this.currentTarget=[null,null],this.renderView(i),this.sim=null,this.endSim=null,this.mainYarn="#F1C113",this.contrastYarn="#1885d8",this.v=30,this.h=40}view(t){return ot`<div class="sim-controls">
        <input
          type="color"
          value=${this.contrastYarn}
          @input=${n=>{this.contrastYarn=n.target.value,this.sync(t)}} /><input
          type="color"
          value=${this.mainYarn}
          @input=${n=>{this.mainYarn=n.target.value,this.sync(t)}} />
        <input
          type="number"
          value=${this.v}
          @input=${n=>{this.v=Number(n.target.value),this.sync(t)}} />
        <input
          type="number"
          value=${this.h}
          @input=${n=>{this.h=Number(n.target.value),this.sync(t)}} />
      </div>
      <div class="simcontainer"></div>`}renderView(t){Mt(this.view(t),this.parentEl)}runSim(t){const n=t.simulation.currentTarget;this.endSim&&this.endSim(),this.endSim=null,this.endSim=Cl(t.simulation.PARAMS,q.fromTile(this.v,this.h,t[n[0]][n[1]].bitmap),this.mainYarn,this.contrastYarn,this.repeatsVertical)}sync(t){Te&&clearTimeout(Te),Te=setTimeout(()=>this.runSim(t),500)}}class El{constructor(t,n,i,r){this.parentEl=t,this.dispatch=r,this.renderView(i)}doDownload(t,n,i){let r=document.createElement("a");r.setAttribute("href",ze[t](n,i)),r.setAttribute("download",`pattern.${t}`),r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r)}view(t){const n=t.motifs.motif0;return ot`<div id="export">
      <!-- <div class="control-header">Export</div> -->
      <div class="flex-buttons">
        <button
          @click=${()=>this.doDownload("txt",n.bitmap,n.palette)}>
          TXT
        </button>
        <!-- <button
          @click=${()=>this.doDownload("jpg",n.bitmap,n.palette)}>
          JPG
        </button>
        <button
          @click=${()=>this.doDownload("png",n.bitmap,n.palette)}>
          PNG
        </button> -->
        <button
          @click=${()=>this.doDownload("json",n.bitmap,n.palette)}>
          JSON
        </button>
      </div>
    </div>`}renderView(t){Mt(this.view(t),this.parentEl)}sync(t){this.renderView(t)}}class kl{constructor(t,n,i,r){this.parentEl=t,this.dispatch=r,this.renderView(i)}view(t){return ot`<div>There's nothing here!</div>
      <button @click=${()=>this.dispatch("newMotif")}>new motif</button>`}renderView(t){Mt(this.view(this.dispatch),this.parentEl)}sync(t){}}class zl{constructor(t,n,i,r){this.parentEl=t,this.dispatch=r,this.renderView(i)}view(t){return ot`<div>There's nothing here!</div>
      <button @click=${()=>this.dispatch("newMotif")}>new motif</button>`}renderView(t){Mt(this.view(this.dispatch),this.parentEl)}sync(t){}}function Pl(e,t){const n=Wn(e);let i=!1,r=1,s=0,o=0,a={x:0,y:0};function l(u){u.style.transformOrigin="0px 0px",u.style.transform=`translate(${s}px, ${o}px) scale(${r})`}function h(){const u=e.querySelectorAll(":scope > .transform-group");for(const g of u)l(g)}function c({x:u,y:g}){let p=(u-s)/r,_=(g-o)/r;return{x:p,y:_}}n("pointerdown","",u=>{if(t.activeTool!=="pan")return;let g=u.currentTarget.getBoundingClientRect();const p=u.pageX-g.left,_=u.pageY-g.top;i=!0,a={x:p-s,y:_-o}}),n("pointermove","",u=>{if(!i)return;let g=u.currentTarget.getBoundingClientRect();const p=u.pageX-g.left,_=u.pageY-g.top;s=p-a.x,o=_-a.y,h()}),n("pointerup","",u=>{i=!1}),n("mouseleave","#canvas-container",u=>{i=!1}),n("wheel","",u=>{let g=(u.offsetX-s)/r,p=(u.offsetY-o)/r;Math.sign(u.deltaY)<0?r*=1.03:r/=1.03,s=u.offsetX-g*r,o=u.offsetY-p*r,h(),u.preventDefault()},{passive:!1});function f(u){r=u.scale,s=u.x,o=u.y,h()}function d(u){const g=e.getBoundingClientRect(),p=u.x[1]-u.x[0],_=u.y[1]-u.y[0],y=g.width/p,x=g.height/_,S=Math.min(y,x)*.95;r=S;const w={x:(u.x[0]+u.x[1])/2*S-g.width/2,y:(u.y[0]+u.y[1])/2*S-g.height/2};s=-w.x,o=-w.y,h()}return{scale:()=>r,x:()=>s,y:()=>o,setScaleXY:d,toWorkspaceCoords:c,setPanZoom:f}}function Il(e,t,n,i,r){let s=e;function o(a,l){if(a.pX==s.pX&&a.pY==s.pY)return;const h=l.motifs[t].bitmap.line({x:s.pX,y:s.pY},{x:a.pX,y:a.pY},r);s=a,i("editMotif",{motifID:t,bitmap:h})}return o(e,n),o}function Ll(e,t,n,i,r){let s=e;function o(a,l){a.pX==s.pX&&a.pY==s.pY||(s=a,i("editMotif",{motifID:t,bitmap:l.motifs[t].bitmap.flood({x:s.pX,y:s.pY},r)}))}return o(e,n),o}function Dl(e,t,n,i,r){const s=n.motifs[t].bitmap;let o=e;function a(l){l.pX==o.pX&&l.pY==o.pY||(o=l,i("editMotif",{bitmap:s.rect({x:e.pX,y:e.pY},{x:o.pX,y:o.pY},r),motifID:t}))}return a(e),a}function Rl(e,t,n,i,r){const s=n.motifs[t].bitmap;let o=e;function a(l){l.pX==o.pX&&l.pY==o.pY||(o=l,i("editMotif",{bitmap:s.line({x:e.pX,y:e.pY},{x:o.pX,y:o.pY},r),motifID:t}))}return a(e),a}const Ol={line:Rl,brush:Il,flood:Ll,rect:Dl};function Hl(e,t,n){const i=Wn(e);let r=null;function s(o){let a=e.getBoundingClientRect();return{pX:Math.floor((o.clientX-a.left)/t.panZoom.scale()/t.scale[0]),pY:Math.floor((o.clientY-a.top)/t.panZoom.scale()/t.scale[1]),cX:o.clientX,cY:o.clientY}}i("pointerdown","",o=>{o.preventDefault();const a=o.button===0?0:1,l=n(s(o),a);l&&(r=h=>{l(s(h))})}),i("pointermove","",o=>{if(o.preventDefault(),o.buttons==0){r=null;return}r&&r(o)})}function Vl(e,t,n,i){const r=t.motifs[e].bitmap,s=r.width,o=r.height;return ot`<div class="size">
    <div
      class="input-spinner"
      @click=${()=>n("resizeMotif",[s-1,o,e],i)}>
      <i class="fa-solid fa-minus fa-2xs fa-fw"></i>
    </div>
    <input
      type="text"
      inputmode="numeric"
      min="1"
      step="1"
      id="width"
      @change=${a=>n("resizeMotif",[Number(a.target.value),o,e],i)}
      value=${s} />
    <div
      class="input-spinner"
      @click=${()=>n("resizeMotif",[s+1,o,e],i)}>
      <i class="fa-solid fa-plus fa-2xs fa-fw"></i>
    </div>
    <span>by</span>
    <div
      class="input-spinner"
      @click=${()=>n("resizeMotif",[s,o-1,e],i)}>
      <i class="fa-solid fa-minus fa-2xs fa-fw"></i>
    </div>
    <input
      type="text"
      inputmode="numeric"
      min="1"
      step="1"
      @change=${a=>n("resizeMotif",[s,Number(a.target.value),e],i)}
      value=${o} />
    <div
      class="input-spinner"
      @click=${()=>n("resizeMotif",[s,o+1,e],i)}>
      <i class="fa-solid fa-plus fa-2xs fa-fw"></i>
    </div>
  </div>`}function Yl(e,t){return ot`
    <div class="tool-group">
      <div
        class="tool-select ${e=="brush"?"selected":"not-selected"}"
        @click=${()=>t("brush")}>
        <i class="fa-solid fa-paintbrush"></i>
      </div>
      <div
        class="tool-select ${e=="flood"?"selected":"not-selected"}"
        @click=${()=>t("flood")}>
        <i class="fa-solid fa-fill-drip"></i>
      </div>
      <div
        class="tool-select ${e=="rect"?"selected":"not-selected"}"
        @click=${()=>t("rect")}>
        <i class="fa-solid fa-vector-square"></i>
      </div>
      <div
        class="tool-select ${e=="line"?"selected":"not-selected"}"
        @click=${()=>t("line")}>
        <i class="fa-solid fa-minus"></i>
      </div>
      <div
        class="tool-select ${e=="pan"?"selected":"not-selected"}"
        @click=${()=>t("pan")}>
        <i class="fa-solid fa-up-down-left-right"></i>
      </div>
    </div>
  `}class Xl{constructor(t,n,i,r){this.parentEl=t,this.canvasEl=null,this.motifID=n,this.dispatch=r,this.paneState={activeTool:"brush",activeColor:0,panZoom:null,scale:i.motifs[this.motifID].palette.scale},this.renderView(i),this.canvasContainer=this.parentEl.querySelectorAll(":scope > .canvas-container")[0],this.canvasEl=this.parentEl.getElementsByClassName("bitmap-canvas")[0],this.paneState.panZoom=Pl(this.canvasContainer,this.paneState);const s=i.motifs[this.motifID],o=s.bitmap,a=s.palette;this.paneState.panZoom.setScaleXY({x:[0,o.width*a.scale[0]],y:[0,o.height*a.scale[1]]});const l=(h,c)=>{let f=Ol[this.paneState.activeTool];if(!f)return;let d=f(h,this.motifID,i,r,c);if(d)return u=>d(u,i)};Hl(this.canvasEl,this.paneState,l)}renderView(t){Mt(this.view(t),this.parentEl)}center(t){let n=t.motifs[this.motifID];this.paneState.panZoom.setScaleXY({x:[0,n.bitmap.width*n.palette.scale[0]],y:[0,n.bitmap.height*n.palette.scale[1]]})}view(t){return ot` <div class="canvas-container">
        <canvas class="bitmap-canvas transform-group"></canvas>
      </div>
      <div class="toolbar">
        ${Yl(this.paneState.activeTool,n=>{this.paneState.activeTool=n,this.renderView(t)})}
        ${Vl(this.motifID,t,this.dispatch,this.center.bind(this))}
      </div>`}sync(t){let n=t.motifs[this.motifID];n.bimpCanvas.updateOffscreenCanvas(n.bitmap,n.palette),n.bimpCanvas.transferOffscreenToCanvas(this.canvasEl)}}const Fl={sizes:[30,70],children:[{sizes:[80,20],children:["motif0","download"]},["simulation"]]},ve={motif0:"motif",download:"download",simulation:"simulation"},Bl={motif:Xl,empty:zl,simulation:Tl,color:kl,download:El},Xn=new q(24,20,hr.triangle),bt={title:"untitled",history:[],motifs:{motif0:{bitmap:Xn,palette:mt,bimpCanvas:new ke(Xn,mt)}},simulation:{currentTarget:["motifs","motif0"],PARAMS:{yarnWidth:8,hDist:15,vDist:20}},motifCounter:1};Mt(ot`
    <!-- <div id="sidebar"></div> -->
    <div id="container"></div>
  `,document.body);const Ul=document.getElementById("container");document.getElementById("sidebar");const zi=new qi(Fl,Ul,rn,Pi);function Pi(e,t,n){n&&(ve[t]=new Bl[n](document.getElementById(e),t,bt,Ii))}async function Ii(e,t,n){try{const{changes:i,postRender:r}=gr[e](bt,t,Ii);Object.assign(bt,i),rn(),r&&r(),n&&n(bt)}catch(i){console.error(`Problem in action ${e}`),console.error(i)}}function rn(){Object.entries(zi.paneMap).forEach(([e,t])=>{ve[t].sync(bt),ve[t].renderView(bt)})}function ql(){Object.entries(zi.paneMap).forEach(([e,t])=>{Pi(e,t,ve[t])}),rn()}window.onload=ql;
